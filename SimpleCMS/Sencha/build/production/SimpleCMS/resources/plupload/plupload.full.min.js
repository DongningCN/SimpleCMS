!function(c,b){var a=function(){var d={};return b.apply(d,arguments),d.moxie};"function"==typeof define&&define.amd?define("moxie",[],a):"object"==typeof module&&module.exports?module.exports=a():c.moxie=a()}(this||window,function(){!function(h,d){function c(o,l){for(var a,p=[],m=0;m<o.length;++m){if(a=f[o[m]]||j(o[m]),!a){throw"module definition dependecy not found: "+o[m]}p.push(a)}l.apply(null,p)}function k(i,l,a){if("string"!=typeof i){throw"invalid module definition, module id must be defined and be a string"}if(l===d){throw"invalid module definition, dependencies must be specified"}if(a===d){throw"invalid module definition, definition function must be specified"}c(l,function(){f[i]=a.apply(null,arguments)})}function g(a){return !!f[a]}function j(e){for(var a=h,m=e.split(/[.\/]/),l=0;l<m.length;++l){if(!a[m[l]]){return}a=a[m[l]]}return a}function b(m){for(var s=0;s<m.length;s++){for(var p=h,q=m[s],e=q.split(/[.\/]/),l=0;l<e.length-1;++l){p[e[l]]===d&&(p[e[l]]={}),p=p[e[l]]}p[e[e.length-1]]=f[q]}}var f={};k("moxie/core/utils/Basic",[],function(){function P(i){var a;return i===a?"undefined":null===i?"null":i.nodeType?"node":{}.toString.call(i).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()}function D(){return S(!1,!1,arguments)}function L(){return S(!0,!1,arguments)}function I(){return S(!1,!0,arguments)}function F(){return S(!0,!0,arguments)}function H(a){switch(P(a)){case"array":return Array.prototype.slice.call(a);case"object":return D({},a)}return a}function S(e,a,o){var m,l=o[0];return C(o,function(p,i){i>0&&C(p,function(t,r){var s=-1!==J(P(t),["array","object"]);return t===m||e&&l[r]===m?!0:(s&&a&&(t=H(t)),P(l[r])===P(t)&&s?S(e,a,[l[r],t]):l[r]=t,void 0)})}),l}function E(m,l){function a(){this.constructor=m}for(var o in l){({}).hasOwnProperty.call(l,o)&&(m[o]=l[o])}return a.prototype=l.prototype,m.prototype=new a,m.__parent__=l.prototype,m}function C(u,p){var m,w,s,v;if(u){try{m=u.length}catch(l){m=v}if(m===v||"number"!=typeof m){for(w in u){if(u.hasOwnProperty(w)&&p(u[w],w)===!1){return}}}else{for(s=0;m>s;s++){if(p(u[s],s)===!1){return}}}}}function R(e){var a;if(!e||"object"!==P(e)){return !0}for(a in e){return !1}return !0}function K(e,a){function p(i){"function"===P(e[i])&&e[i](function(n){++i<m&&!n?p(i):a(n)})}var l=0,m=e.length;"function"!==P(a)&&(a=function(){}),e&&e.length||a(),p(l)}function Q(o,l){var a=0,p=o.length,m=new Array(p);C(o,function(i,n){i(function(s){if(s){return l(s)}var r=[].slice.call(arguments);r.shift(),m[n]=r,a++,a===p&&(m.unshift(null),l.apply(this,m))})})}function J(m,l){if(l){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(l,m)}for(var a=0,o=l.length;o>a;a++){if(l[a]===m){return a}}}return -1}function M(e,a){var m=[];"array"!==P(e)&&(e=[e]),"array"!==P(a)&&(a=[a]);for(var l in e){-1===J(e[l],a)&&m.push(e[l])}return m.length?m:!1}function O(m,l){var a=[];return C(m,function(i){-1!==J(i,l)&&a.push(i)}),a.length?a:null}function G(m){var l,a=[];for(l=0;l<m.length;l++){a[l]=m[l]}return a}function N(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a}function z(m){if("string"!=typeof m){return m}var l,a={t:1099511627776,g:1073741824,m:1048576,k:1024};return m=/^([0-9\.]+)([tmgk]?)$/.exec(m.toLowerCase().replace(/[^0-9\.tmkg]/g,"")),l=m[2],m=+m[1],a.hasOwnProperty(l)&&(m*=a[l]),Math.floor(m)}function B(e){var a=[].slice.call(arguments,1);return e.replace(/%[a-z]/g,function(){var i=a.shift();return"undefined"!==P(i)?i:""})}function A(m,l){var a=this;setTimeout(function(){m.call(a)},l||1)}var q=function(){var a=0;return function(l){var e,m=(new Date).getTime().toString(32);for(e=0;5>e;e++){m+=Math.floor(65535*Math.random()).toString(32)}return(l||"o_")+m+(a++).toString(32)}}();return{guid:q,typeOf:P,extend:D,extendIf:L,extendImmutable:I,extendImmutableIf:F,inherit:E,each:C,isEmptyObj:R,inSeries:K,inParallel:Q,inArray:J,arrayDiff:M,arrayIntersect:O,toArray:G,trim:N,sprintf:B,parseSizeStr:z,delay:A}}),k("moxie/core/utils/Encode",[],function(){var m=function(i){return unescape(encodeURIComponent(i))},l=function(i){return decodeURIComponent(escape(i))},a=function(C,z){if("function"==typeof window.atob){return z?l(window.atob(C)):window.atob(C)}var w,q,v,F,H,G,E,y,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",x=0,A=0,B="",t=[];if(!C){return C}C+="";do{F=D.indexOf(C.charAt(x++)),H=D.indexOf(C.charAt(x++)),G=D.indexOf(C.charAt(x++)),E=D.indexOf(C.charAt(x++)),y=F<<18|H<<12|G<<6|E,w=255&y>>16,q=255&y>>8,v=255&y,t[A++]=64==G?String.fromCharCode(w):64==E?String.fromCharCode(w,q):String.fromCharCode(w,q,v)}while(x<C.length);return B=t.join(""),z?l(B):B},o=function(H,z){if(z&&(H=m(H)),"function"==typeof window.btoa){return window.btoa(H)}var w,e,v,F,I,G,E,y,D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",x=0,A=0,C="",q=[];if(!H){return H}do{w=H.charCodeAt(x++),e=H.charCodeAt(x++),v=H.charCodeAt(x++),y=w<<16|e<<8|v,F=63&y>>18,I=63&y>>12,G=63&y>>6,E=63&y,q[A++]=D.charAt(F)+D.charAt(I)+D.charAt(G)+D.charAt(E)}while(x<H.length);C=q.join("");var B=H.length%3;return(B?C.slice(0,B-3):C)+"===".slice(B||3)};return{utf8_encode:m,utf8_decode:l,atob:a,btoa:o}}),k("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(p){function l(z,C,y){var x=0,v=0,w=0,A={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},D=function(i){return i=(""+i).replace(/[_\-+]/g,"."),i=i.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),i.length?i.split("."):[-8]},B=function(i){return i?isNaN(i)?A[i]||-7:parseInt(i,10):0};for(z=D(z),C=D(C),v=Math.max(z.length,C.length),x=0;v>x;x++){if(z[x]!=C[x]){if(z[x]=B(z[x]),C[x]=B(C[x]),z[x]<C[x]){w=-1;break}if(z[x]>C[x]){w=1;break}}}if(!y){return w}switch(y){case">":case"gt":return w>0;case">=":case"ge":return w>=0;case"<=":case"le":return 0>=w;case"==":case"=":case"eq":return 0===w;case"<>":case"!=":case"ne":return 0!==w;case"":case"<":case"lt":return 0>w;default:return null}}var a=function(B){var G="",A="?",x="function",v="undefined",w="object",E="name",H="version",F={has:function(n,i){return -1!==i.toLowerCase().indexOf(n.toLowerCase())},lowerize:function(i){return i.toLowerCase()}},D={rgx:function(){for(var N,o,L,O,M,K,n,J=0,e=arguments;J<e.length;J+=2){var r=e[J],I=e[J+1];if(typeof N===v){N={};for(O in I){M=I[O],typeof M===w?N[M[0]]=B:N[M]=B}}for(o=L=0;o<r.length;o++){if(K=r[o].exec(this.getUA())){for(O=0;O<I.length;O++){n=K[++L],M=I[O],typeof M===w&&M.length>0?2==M.length?N[M[0]]=typeof M[1]==x?M[1].call(this,n):M[1]:3==M.length?N[M[0]]=typeof M[1]!==x||M[1].exec&&M[1].test?n?n.replace(M[1],M[2]):B:n?M[1].call(this,n,M[2]):B:4==M.length&&(N[M[0]]=n?M[3].call(this,n.replace(M[1],M[2])):B):N[M]=n?n:B}break}}if(K){break}}return N},str:function(i,u){for(var o in u){if(typeof u[o]===w&&u[o].length>0){for(var e=0;e<u[o].length;e++){if(F.has(u[o][e],i)){return o===A?B:o}}}else{if(F.has(u[o],i)){return o===A?B:o}}}return i}},z={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},C={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[E,H],[/\s(opr)\/([\w\.]+)/i],[[E,"Opera"],H],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[E,H],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[E,"IE"],H],[/(edge)\/((\d+)?[\w\.]+)/i],[E,H],[/(yabrowser)\/([\w\.]+)/i],[[E,"Yandex"],H],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],H],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[E,H],[/(dolfin)\/([\w\.]+)/i],[[E,"Dolphin"],H],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[E,"Chrome"],H],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[H,[E,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[H,[E,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[H,[E,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[H,[E,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[H,E],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[E,[H,D.str,z.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[E,H],[/(navigator|netscape)\/([\w\.-]+)/i],[[E,"Netscape"],H],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[E,H]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[H,[E,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[E,H],[/rv\:([\w\.]+).*(gecko)/i],[H,E]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[E,H],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[E,[H,D.str,z.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[E,"Windows"],[H,D.str,z.os.windows.version]],[/\((bb)(10);/i],[[E,"BlackBerry"],H],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[E,H],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[E,"Symbian"],H],[/\((series40);/i],[E],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[E,"Firefox OS"],H],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[E,H],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[E,"Chromium OS"],H],[/(sunos)\s?([\w\.]+\d)*/i],[[E,"Solaris"],H],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[E,H],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[E,"iOS"],[H,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[E,"Mac OS"],[H,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[E,H]]},y=function(o){var n=o||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:G);this.getBrowser=function(){return D.rgx.apply(this,C.browser)},this.getEngine=function(){return D.rgx.apply(this,C.engine)},this.getOS=function(){return D.rgx.apply(this,C.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return n},this.setUA=function(i){return n=i,this},this.setUA(n)};return y}(),s=function(){var e={define_property:function(){return !1}(),create_canvas:function(){var i=document.createElement("canvas");return !(!i.getContext||!i.getContext("2d"))}(),return_response_type:function(r){try{if(-1!==p.inArray(r,["","text","document"])){return !0}if(window.XMLHttpRequest){var o=new XMLHttpRequest;if(o.open("get","/"),"responseType" in o){return o.responseType=r,o.responseType!==r?!1:!0}}}catch(u){}return !1},use_data_uri:function(){var i=new Image;return i.onload=function(){e.use_data_uri=1===i.width&&1===i.height},setTimeout(function(){i.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return e.use_data_uri&&("IE"!==q.browser||q.version>=9)},use_data_uri_of:function(i){return e.use_data_uri&&33000>i||e.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/)){return !1}var i=document.createElement("input");return i.setAttribute("type","file"),!i.disabled}};return function(o){var r=[].slice.call(arguments);return r.shift(),"function"===p.typeOf(e[o])?e[o].apply(this,r):!!e[o]}}(),m=(new a).getResult(),q={can:s,uaParser:a,browser:m.browser.name,version:m.browser.version,os:m.os.name,osVersion:m.os.version,verComp:l,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return q.OS=q.os,q}),k("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(i){function a(n,m){var l;for(l in n){if(n[l]===m){return l}}return null}return{RuntimeError:function(){function e(n,m){this.code=n,this.name=a(l,n),this.message=this.name+(m||": RuntimeError "+this.code)}var l={NOT_INIT_ERR:1,EXCEPTION_ERR:3,NOT_SUPPORTED_ERR:9,JS_ERR:4};return i.extend(e,l),e.prototype=Error.prototype,e}(),OperationNotAllowedException:function(){function e(l){this.code=l,this.name="OperationNotAllowedException"}return i.extend(e,{NOT_ALLOWED_ERR:1}),e.prototype=Error.prototype,e}(),ImageError:function(){function e(m){this.code=m,this.name=a(l,m),this.message=this.name+": ImageError "+this.code}var l={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};return i.extend(e,l),e.prototype=Error.prototype,e}(),FileException:function(){function e(m){this.code=m,this.name=a(l,m),this.message=this.name+": FileException "+this.code}var l={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return i.extend(e,l),e.prototype=Error.prototype,e}(),DOMException:function(){function e(m){this.code=m,this.name=a(l,m),this.message=this.name+": DOMException "+this.code}var l={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return i.extend(e,l),e.prototype=Error.prototype,e}(),EventException:function(){function e(l){this.code=l,this.name="EventException"}return i.extend(e,{UNSPECIFIED_EVENT_TYPE_ERR:0}),e.prototype=Error.prototype,e}()}}),k("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(v){var p=function(a){return"string"!=typeof a?a:document.getElementById(a)},m=function(o,n){if(!o.className){return !1}var a=new RegExp("(^|\\s+)"+n+"(\\s+|$)");return a.test(o.className)},x=function(i,a){m(i,a)||(i.className=i.className?i.className.replace(/\s+$/,"")+" "+a:a)},u=function(o,n){if(o.className){var a=new RegExp("(^|\\s+)"+n+"(\\s+|$)");o.className=o.className.replace(a,function(y,s,r){return" "===s&&" "===r?" ":""})}},w=function(i,a){return i.currentStyle?i.currentStyle[a]:window.getComputedStyle?window.getComputedStyle(i,null)[a]:void 0},l=function(E,A){function z(G){var o,a,H=0,s=0;return G&&(a=G.getBoundingClientRect(),o="CSS1Compat"===B.compatMode?B.documentElement:B.body,H=a.left+o.scrollLeft,s=a.top+o.scrollTop),{x:H,y:s}}var e,y,C,F=0,D=0,B=document;if(E=E,A=A||B.body,E&&E.getBoundingClientRect&&"IE"===v.browser&&(!B.documentMode||B.documentMode<8)){return y=z(E),C=z(A),{x:y.x-C.x,y:y.y-C.y}}for(e=E;e&&e!=A&&e.nodeType;){F+=e.offsetLeft||0,D+=e.offsetTop||0,e=e.offsetParent}for(e=E.parentNode;e&&e!=A&&e.nodeType;){F-=e.scrollLeft||0,D-=e.scrollTop||0,e=e.parentNode}return{x:F,y:D}},q=function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}};return{get:p,hasClass:m,addClass:x,removeClass:u,getStyle:w,getPos:l,getSize:q}}),k("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(o,l,a){function p(){this.uid=a.guid()}var m={};return a.extend(p.prototype,{init:function(){this.uid||(this.uid=a.guid("uid_"))},addEventListener:function(u,q,w,v){var i,r=this;return this.hasOwnProperty("uid")||(this.uid=a.guid("uid_")),u=a.trim(u),/\s/.test(u)?(a.each(u.split(/\s+/),function(n){r.addEventListener(n,q,w,v)}),void 0):(u=u.toLowerCase(),w=parseInt(w,10)||0,i=m[this.uid]&&m[this.uid][u]||[],i.push({fn:q,priority:w,scope:v||this}),m[this.uid]||(m[this.uid]={}),m[this.uid][u]=i,void 0)},hasEventListener:function(n){var i;return n?(n=n.toLowerCase(),i=m[this.uid]&&m[this.uid][n]):i=m[this.uid],i?i:!1},removeEventListener:function(r,q){var u,s,i=this;if(r=r.toLowerCase(),/\s/.test(r)){return a.each(r.split(/\s+/),function(n){i.removeEventListener(n,q)}),void 0}if(u=m[this.uid]&&m[this.uid][r]){if(q){for(s=u.length-1;s>=0;s--){if(u[s].fn===q){u.splice(s,1);break}}}else{u=[]}u.length||(delete m[this.uid][r],a.isEmptyObj(m[this.uid])&&delete m[this.uid])}},removeAllEventListeners:function(){m[this.uid]&&delete m[this.uid]},dispatchEvent:function(t){var q,i,x,z,y,w={},r=!0;if("string"!==a.typeOf(t)){if(z=t,"string"!==a.typeOf(z.type)){throw new l.EventException(l.EventException.UNSPECIFIED_EVENT_TYPE_ERR)}t=z.type,z.total!==y&&z.loaded!==y&&(w.total=z.total,w.loaded=z.loaded),w.async=z.async||!1}if(-1!==t.indexOf("::")?function(e){q=e[0],t=e[1]}(t.split("::")):q=this.uid,t=t.toLowerCase(),i=m[q]&&m[q][t]){i.sort(function(s,n){return n.priority-s.priority}),x=[].slice.call(arguments),x.shift(),w.type=t,x.unshift(w);var v=[];a.each(i,function(n){x[0].target=n.scope,w.async?v.push(function(e){setTimeout(function(){e(n.fn.apply(n.scope,x)===!1)},1)}):v.push(function(e){e(n.fn.apply(n.scope,x)===!1)})}),v.length&&a.inSeries(v,function(n){r=!n})}return r},bindOnce:function(v,s,q,x){var u=this;u.bind.call(this,v,function w(){return u.unbind(v,w),s.apply(this,arguments)},q,x)},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(n){var i=this;this.bind(n.join(" "),function(r){var q="on"+r.type.toLowerCase();"function"===a.typeOf(this[q])&&this[q].apply(this,arguments)}),a.each(n,function(q){q="on"+q.toLowerCase(q),"undefined"===a.typeOf(i[q])&&(i[q]=null)})}}),p.instance=new p,p}),k("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(s,p,m,v){function q(w,i,a,A,z){var y,t=this,x=p.guid(i+"_"),r=z||"browser";w=w||{},l[x]=this,a=p.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},a),w.preferred_caps&&(r=q.getMode(A,w.preferred_caps,r)),y=function(){var n={};return{exec:function(o,e,C,B){return y[e]&&(n[o]||(n[o]={context:this,instance:new y[e]}),n[o].instance[C])?n[o].instance[C].apply(this,B):void 0},removeInstance:function(e){delete n[e]},removeAllInstances:function(){var e=this;p.each(n,function(o,B){"function"===p.typeOf(o.instance.destroy)&&o.instance.destroy.call(o.context),e.removeInstance(B)})}}}(),p.extend(this,{initialized:!1,uid:x,type:i,mode:q.getMode(A,w.required_caps,r),shimid:x+"_container",clients:0,options:w,can:function(C,B){var D=arguments[2]||a;if("string"===p.typeOf(C)&&"undefined"===p.typeOf(B)&&(C=q.parseCaps(C)),"object"===p.typeOf(C)){for(var o in C){if(!this.can(o,C[o],D)){return !1}}return !0}return"function"===p.typeOf(D[C])?D[C].call(this,B):B===D[C]},getShimContainer:function(){var o,B=m.get(this.shimid);return B||(o=m.get(this.options.container)||document.body,B=document.createElement("div"),B.id=this.shimid,B.className="moxie-shim moxie-shim-"+this.type,p.extend(B.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),o.appendChild(B),o=null),B},getShim:function(){return y},shimExec:function(B,o){var n=[].slice.call(arguments,2);return t.getShim().exec.call(this,this.uid,B,o,n)},exec:function(B,o){var n=[].slice.call(arguments,2);return t[B]&&t[B][o]?t[B][o].apply(this,n):t.shimExec.apply(this,arguments)},destroy:function(){if(t){var n=m.get(this.shimid);n&&n.parentNode.removeChild(n),y&&y.removeAllInstances(),this.unbindAll(),delete l[this.uid],this.uid=null,x=t=y=n=null}}}),this.mode&&w.required_caps&&!this.can(w.required_caps)&&(this.mode=!1)}var u={},l={};return q.order="html5,flash,silverlight,html4",q.getRuntime=function(a){return l[a]?l[a]:!1},q.addConstructor=function(i,a){a.prototype=v.instance,u[i]=a},q.getConstructor=function(a){return u[a]||null},q.getInfo=function(i){var a=q.getRuntime(i);return a?{uid:a.uid,type:a.type,mode:a.mode,can:function(){return a.can.apply(a,arguments)}}:null},q.parseCaps=function(n){var a={};return"string"!==p.typeOf(n)?n||{}:(p.each(n.split(","),function(i){a[i]=!0}),a)},q.can=function(w,r){var a,y,x=q.getConstructor(w);return x?(a=new x({required_caps:r}),y=a.mode,a.destroy(),!!y):!1},q.thatCan=function(r,o){var a=(o||q.order).split(/\s*,\s*/);for(var w in a){if(q.can(a[w],r)){return a[w]}}return null},q.getMode=function(t,a,w){var o=null;if("undefined"===p.typeOf(w)&&(w="browser"),a&&!p.isEmptyObj(t)){if(p.each(a,function(e,x){if(t.hasOwnProperty(x)){var r=t[x](e);if("string"==typeof r&&(r=[r]),o){if(!(o=p.arrayIntersect(o,r))){return o=!1}}else{o=r}}}),o){return -1!==p.inArray(w,o)?w:o[0]}if(o===!1){return !1}}return w},q.capTrue=function(){return !0},q.capFalse=function(){return !1},q.capTest=function(a){return function(){return !!a}},q}),k("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(m,l,a,o){return function(){var i;a.extend(this,{connectRuntime:function(p){function q(t){var r,s;return t.length?(r=t.shift().toLowerCase(),(s=o.getConstructor(r))?(i=new s(p),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,n.ruid=i.uid,n.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),q(t)}),i.bind("Exception",function(v,u){var w=u.name+"(#"+u.code+")"+(u.message?", from: "+u.message:"");n.trigger("RuntimeError",new l.RuntimeError(l.RuntimeError.EXCEPTION_ERR,w))}),i.mode?(i.init(),void 0):(i.trigger("Error"),void 0)):(q(t),void 0)):(n.trigger("RuntimeError",new l.RuntimeError(l.RuntimeError.NOT_INIT_ERR)),i=null,void 0)}var e,n=this;if("string"===a.typeOf(p)?e=p:"string"===a.typeOf(p.ruid)&&(e=p.ruid),e){if(i=o.getRuntime(e)){return n.ruid=e,i.clients++,i}throw new l.RuntimeError(l.RuntimeError.NOT_INIT_ERR)}q((p.runtime_order||o.order).split(/\s*,\s*/))},disconnectRuntime:function(){i&&--i.clients<=0&&i.destroy(),i=null},getRuntime:function(){return i&&i.uid?i:i=null},exec:function(){return i?i.exec.apply(this,arguments):null},can:function(e){return i?i.can(e):!1}})}}),k("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(o,l,a){function p(n,e){function i(u,r,w){var q,v=m[this.uid];return"string"===o.typeOf(v)&&v.length?(q=new p(null,{type:w,size:r-u}),q.detach(v.substr(u,q.size)),q):null}a.call(this),n&&this.connectRuntime(n),e?"string"===o.typeOf(e)&&(e={data:e}):e={},o.extend(this,{uid:e.uid||o.guid("uid_"),ruid:n,size:e.size||0,type:e.type||"",slice:function(s,r,q){return this.isDetached()?i.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),s,r,q)},getSource:function(){return m[this.uid]?m[this.uid]:null},detach:function(r){if(this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),r=r||"","data:"==r.substr(0,5)){var q=r.indexOf(";base64,");this.type=r.substring(5,q),r=l.atob(r.substring(q+8))}this.size=r.length,m[this.uid]=r},isDetached:function(){return !this.ruid&&"string"===o.typeOf(m[this.uid])},destroy:function(){this.detach(),delete m[this.uid]}}),e.data?this.detach(e.data):m[this.uid]=e}var m={};return p}),k("moxie/core/I18n",["moxie/core/utils/Basic"],function(i){var a={};return{addI18n:function(e){return i.extend(a,e)},translate:function(l){return a[l]||l},_:function(l){return this.translate(l)},sprintf:function(l){var e=[].slice.call(arguments,1);return l.replace(/%[a-z]/g,function(){var m=e.shift();return"undefined"!==i.typeOf(m)?m:""})}}}),k("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(m,l){var a="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",o={mimes:{},extensions:{},addMimeType:function(u){var q,p,v,s=u.split(/,/);for(q=0;q<s.length;q+=2){for(v=s[q+1].split(/ /),p=0;p<v.length;p++){this.mimes[v[p]]=s[q]}this.extensions[s[q]]=v}},extList2mimes:function(v,q){var z,x,y,e,w=this,p=[];for(x=0;x<v.length;x++){for(z=v[x].extensions.toLowerCase().split(/\s*,\s*/),y=0;y<z.length;y++){if("*"===z[y]){return[]}if(e=w.mimes[z[y]],q&&/^\w+$/.test(z[y])){p.push("."+z[y])}else{if(e&&-1===m.inArray(e,p)){p.push(e)}else{if(!e){return[]}}}}}return p},mimes2exts:function(p){var e=this,q=[];return m.each(p,function(i){if(i=i.toLowerCase(),"*"===i){return q=[],!1}var n=i.match(/^(\w+)\/(\*|\w+)$/);n&&("*"===n[2]?m.each(e.extensions,function(s,r){new RegExp("^"+n[1]+"/").test(r)&&[].push.apply(q,e.extensions[r])}):e.extensions[i]&&[].push.apply(q,e.extensions[i]))}),q},mimes2extList:function(e){var q=[],p=[];return"string"===m.typeOf(e)&&(e=m.trim(e).split(/\s*,\s*/)),p=this.mimes2exts(e),q.push({title:l.translate("Files"),extensions:p.length?p.join(","):"*"}),q.mimes=e,q},getFileExtension:function(n){var i=n&&n.match(/\.([^.]+)$/);return i?i[1].toLowerCase():""},getFileMime:function(i){return this.mimes[this.getFileExtension(i)]||""}};return o.addMimeType(a),o}),k("moxie/file/FileInput",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Mime","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/I18n","moxie/runtime/Runtime","moxie/runtime/RuntimeClient"],function(x,B,w,q,m,p,z,C,A){function y(a){var i,l,e;if(-1!==x.inArray(x.typeOf(a),["string","node"])&&(a={browse_button:a}),l=q.get(a.browse_button),!l){throw new m.DOMException(m.DOMException.NOT_FOUND_ERR)}e={accept:[{title:z.translate("All Files"),extensions:"*"}],multiple:!1,required_caps:!1,container:l.parentNode||document.body},a=x.extend({},e,a),"string"==typeof a.required_caps&&(a.required_caps=C.parseCaps(a.required_caps)),"string"==typeof a.accept&&(a.accept=w.mimes2extList(a.accept)),i=q.get(a.container),i||(i=document.body),"static"===q.getStyle(i,"position")&&(i.style.position="relative"),i=l=null,A.call(this),x.extend(this,{uid:x.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){var n=this;n.bind("RuntimeInit",function(s,t){n.ruid=t.uid,n.shimid=t.shimid,n.bind("Ready",function(){n.trigger("Refresh")},999),n.bind("Refresh",function(){var E,G,o,F,D;o=q.get(a.browse_button),F=q.get(t.shimid),o&&(E=q.getPos(o,q.get(a.container)),G=q.getSize(o),D=parseInt(q.getStyle(o,"z-index"),10)||0,F&&x.extend(F.style,{top:E.y+"px",left:E.x+"px",width:G.w+"px",height:G.h+"px",zIndex:D+1})),F=o=null}),t.exec.call(n,"FileInput","init",a)}),n.connectRuntime(x.extend({},a,{required_caps:{select_file:!0}}))},getOption:function(n){return a[n]},setOption:function(r,t){if(a.hasOwnProperty(r)){var s=a[r];switch(r){case"accept":"string"==typeof t&&(t=w.mimes2extList(t));break;case"container":case"required_caps":throw new m.FileException(m.FileException.NO_MODIFICATION_ALLOWED_ERR)}a[r]=t,this.exec("FileInput","setOption",r,t),this.trigger("OptionChanged",r,t,s)}},disable:function(o){var n=this.getRuntime();n&&this.exec("FileInput","disable","undefined"===x.typeOf(o)?!0:o)},refresh:function(){this.trigger("Refresh")},destroy:function(){var n=this.getRuntime();n&&(n.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===x.typeOf(this.files)&&x.each(this.files,function(o){o.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(v)}var v=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return y.prototype=p.instance,y}),k("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(m,l,a){function o(q,i){i||(i={}),a.apply(this,arguments),this.type||(this.type=l.getFileMime(i.name));var p;if(i.name){p=i.name.replace(/\\/g,"/"),p=p.substr(p.lastIndexOf("/")+1)}else{if(this.type){var e=this.type.split("/")[0];p=m.guid((""!==e?e:"file")+"_"),l.extensions[this.type]&&(p+="."+l.extensions[this.type][0])}}m.extend(this,{name:p||m.guid("file_"),relativePath:"",lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString()})}return o.prototype=a.prototype,o}),k("moxie/file/FileDrop",["moxie/core/I18n","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/core/utils/Env","moxie/file/File","moxie/runtime/RuntimeClient","moxie/core/EventTarget","moxie/core/utils/Mime"],function(x,B,w,q,m,p,z,C,A){function y(a){var e,l=this;"string"==typeof a&&(a={drop_zone:a}),e={accept:[{title:x.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},a="object"==typeof a?q.extend({},e,a):e,a.container=B.get(a.drop_zone)||document.body,"static"===B.getStyle(a.container,"position")&&(a.container.style.position="relative"),"string"==typeof a.accept&&(a.accept=A.mimes2extList(a.accept)),z.call(l),q.extend(l,{uid:q.guid("uid_"),ruid:null,files:null,init:function(){l.bind("RuntimeInit",function(n,i){l.ruid=i.uid,i.exec.call(l,"FileDrop","init",a),l.dispatchEvent("ready")}),l.connectRuntime(a)},destroy:function(){var i=this.getRuntime();i&&(i.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(v)}var v=["ready","dragenter","dragleave","drop","error"];return y.prototype=C.instance,y}),k("moxie/file/FileReader",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/Exceptions","moxie/core/EventTarget","moxie/file/Blob","moxie/runtime/RuntimeClient"],function(v,p,m,x,u,w){function l(){function a(i,s){if(this.trigger("loadstart"),this.readyState===l.LOADING){return this.trigger("error",new m.DOMException(m.DOMException.INVALID_STATE_ERR)),this.trigger("loadend"),void 0}if(!(s instanceof u)){return this.trigger("error",new m.DOMException(m.DOMException.NOT_FOUND_ERR)),this.trigger("loadend"),void 0}if(this.result=null,this.readyState=l.LOADING,s.isDetached()){var r=s.getSource();switch(i){case"readAsText":case"readAsBinaryString":this.result=r;break;case"readAsDataURL":this.result="data:"+s.type+";base64,"+p.btoa(r)}this.readyState=l.DONE,this.trigger("load"),this.trigger("loadend")}else{this.connectRuntime(s.ruid),this.exec("FileReader","read",i,s)}}w.call(this),v.extend(this,{uid:v.guid("uid_"),readyState:l.EMPTY,result:null,error:null,readAsBinaryString:function(i){a.call(this,"readAsBinaryString",i)},readAsDataURL:function(i){a.call(this,"readAsDataURL",i)},readAsText:function(i){a.call(this,"readAsText",i)},abort:function(){this.result=null,-1===v.inArray(this.readyState,[l.EMPTY,l.DONE])&&(this.readyState===l.LOADING&&(this.readyState=l.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort(),this.exec("FileReader","destroy"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(q),this.bind("Error",function(n,i){this.readyState=l.DONE,this.error=i},999),this.bind("Load",function(){this.readyState=l.DONE},999)}var q=["loadstart","progress","load","abort","error","loadend"];return l.EMPTY=0,l.LOADING=1,l.DONE=2,l.prototype=x.instance,l}),k("moxie/core/utils/Url",["moxie/core/utils/Basic"],function(m){var l=function(w,q){var e,p=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],z=p.length,B={http:80,https:443},A={},y=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[\da-fA-F:]+\]|[^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,v=y.exec(w||""),x=/^\/\/\w/.test(w);switch(m.typeOf(q)){case"undefined":q=l(document.location.href,!1);break;case"string":q=l(q,!1)}for(;z--;){v[z]&&(A[p[z]]=v[z])}if(e=!x&&!A.scheme,(x||e)&&(A.scheme=q.scheme),e){A.host=q.host,A.port=q.port;var t="";/^[^\/]/.test(A.path)&&(t=q.path,t=/\/[^\/]*\.[^\/]*$/.test(t)?t.replace(/\/[^\/]+$/,"/"):t.replace(/\/?$/,"/")),A.path=t+(A.path||"")}return A.port||(A.port=B[A.scheme]||80),A.port=parseInt(A.port,10),A.path||(A.path="/"),delete A.source,A},a=function(q){var p={http:80,https:443},r="object"==typeof q?q:l(q);return r.scheme+"://"+r.host+(r.port!==p[r.scheme]?":"+r.port:"")+r.path+(r.query?r.query:"")},o=function(p){function n(i){return[i.scheme,i.host,i.port].join("/")}return"string"==typeof p&&(p=l(p)),n(l())===n(p)};return{parseUrl:l,resolveUrl:a,hasSameOrigin:o}}),k("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(m,l,a){function o(){this.uid=m.guid("uid_"),l.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return o.prototype=a.instance,o}),k("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(m,l,a){return function(){function e(v,p){if(!p.isDetached()){var x=this.connectRuntime(p.ruid).exec.call(this,"FileReaderSync","read",v,p);return this.disconnectRuntime(),x}var u=p.getSource();switch(v){case"readAsBinaryString":return u;case"readAsDataURL":return"data:"+p.type+";base64,"+a.btoa(u);case"readAsText":for(var w="",i=0,q=u.length;q>i;i++){w+=String.fromCharCode(u[i])}return w}}l.call(this),m.extend(this,{uid:m.guid("uid_"),readAsBinaryString:function(i){return e.call(this,"readAsBinaryString",i)},readAsDataURL:function(i){return e.call(this,"readAsDataURL",i)},readAsText:function(i){return e.call(this,"readAsText",i)}})}}),k("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(m,l,a){function o(){var i,p=[];l.extend(this,{append:function(q,t){var e=this,n=l.typeOf(t);t instanceof a?i={name:q,value:t}:"array"===n?(q+="[]",l.each(t,function(r){e.append(q,r)})):"object"===n?l.each(t,function(s,r){e.append(q+"["+r+"]",s)}):"null"===n||"undefined"===n||"number"===n&&isNaN(t)?e.append(q,"false"):p.push({name:q,value:t.toString()})},hasBlob:function(){return !!this.getBlob()},getBlob:function(){return i&&i.value||null},getBlobName:function(){return i&&i.name||null},each:function(e){l.each(p,function(n){e(n.value,n.name)}),i&&e(i.value,i.name)},destroy:function(){i=null,p=[]}})}return o}),k("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(D,I,A,x,q,w,G,J,H,F,z,E){function y(){this.uid=D.guid("uid_")}function B(){function ag(u,i){return K.hasOwnProperty(u)?1===arguments.length?z.can("define_property")?K[u]:ae[u]:(z.can("define_property")?K[u]=i:ae[u]=i,void 0):void 0}function Z(i){function M(){m&&(m.destroy(),m=null),u.dispatchEvent("loadend"),u=null}function L(N){m.bind("LoadStart",function(O){ag("readyState",B.LOADING),u.dispatchEvent("readystatechange"),u.dispatchEvent(O),s&&u.upload.dispatchEvent(O)}),m.bind("Progress",function(O){ag("readyState")!==B.LOADING&&(ag("readyState",B.LOADING),u.dispatchEvent("readystatechange")),u.dispatchEvent(O)}),m.bind("UploadProgress",function(O){s&&u.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:O.total,loaded:O.loaded})}),m.bind("Load",function(O){ag("readyState",B.DONE),ag("status",Number(N.exec.call(m,"XMLHttpRequest","getStatus")||0)),ag("statusText",C[ag("status")]||""),ag("response",N.exec.call(m,"XMLHttpRequest","getResponse",ag("responseType"))),~D.inArray(ag("responseType"),["text",""])?ag("responseText",ag("response")):"document"===ag("responseType")&&ag("responseXML",ag("response")),a=N.exec.call(m,"XMLHttpRequest","getAllResponseHeaders"),u.dispatchEvent("readystatechange"),ag("status")>0?(s&&u.upload.dispatchEvent(O),u.dispatchEvent(O)):(Y=!0,u.dispatchEvent("error")),M()}),m.bind("Abort",function(O){u.dispatchEvent(O),M()}),m.bind("Error",function(O){Y=!0,ag("readyState",B.DONE),u.dispatchEvent("readystatechange"),r=!0,u.dispatchEvent(O),M()}),N.exec.call(m,"XMLHttpRequest","send",{url:Q,method:X,async:e,user:W,password:t,headers:l,mimeType:ab,encoding:o,responseType:u.responseType,withCredentials:u.withCredentials,options:af},i)}var u=this;aa=(new Date).getTime(),m=new G,"string"==typeof af.required_caps&&(af.required_caps=w.parseCaps(af.required_caps)),af.required_caps=D.extend({},af.required_caps,{return_response_type:u.responseType}),i instanceof F&&(af.required_caps.send_multipart=!0),D.isEmptyObj(l)||(af.required_caps.send_custom_headers=!0),ad||(af.required_caps.do_cors=!0),af.ruid?L(m.connectRuntime(af)):(m.bind("RuntimeInit",function(O,N){L(N)}),m.bind("RuntimeError",function(O,N){u.dispatchEvent("RuntimeError",N)}),m.connectRuntime(af))}function ah(){ag("responseText",""),ag("responseXML",null),ag("response",null),ag("status",0),ag("statusText",""),aa=ai=null}var Q,X,W,t,aa,ai,m,aj,ae=this,K={timeout:0,readyState:B.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},e=!0,l={},o=null,ab=null,p=!1,ac=!1,s=!1,r=!1,Y=!1,ad=!1,n=null,V=null,af={},a="";D.extend(this,K,{uid:D.guid("uid_"),upload:new y,open:function(O,L,N,M,P){var i;if(!O||!L){throw new I.DOMException(I.DOMException.SYNTAX_ERR)}if(/[\u0100-\uffff]/.test(O)||x.utf8_encode(O)!==O){throw new I.DOMException(I.DOMException.SYNTAX_ERR)}if(~D.inArray(O.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(X=O.toUpperCase()),~D.inArray(X,["CONNECT","TRACE","TRACK"])){throw new I.DOMException(I.DOMException.SECURITY_ERR)}if(L=x.utf8_encode(L),i=q.parseUrl(L),ad=q.hasSameOrigin(i),Q=q.resolveUrl(L),(M||P)&&!ad){throw new I.DOMException(I.DOMException.INVALID_ACCESS_ERR)}if(W=M||i.user,t=P||i.pass,e=N||!0,e===!1&&(ag("timeout")||ag("withCredentials")||""!==ag("responseType"))){throw new I.DOMException(I.DOMException.INVALID_ACCESS_ERR)}p=!e,ac=!1,l={},ah.call(this),ag("readyState",B.OPENED),this.dispatchEvent("readystatechange")},setRequestHeader:function(u,L){var i=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(ag("readyState")!==B.OPENED||ac){throw new I.DOMException(I.DOMException.INVALID_STATE_ERR)}if(/[\u0100-\uffff]/.test(u)||x.utf8_encode(u)!==u){throw new I.DOMException(I.DOMException.SYNTAX_ERR)}return u=D.trim(u).toLowerCase(),~D.inArray(u,i)||/^(proxy\-|sec\-)/.test(u)?!1:(l[u]?l[u]+=", "+L:l[u]=L,!0)},hasRequestHeader:function(i){return i&&l[i.toLowerCase()]||!1},getAllResponseHeaders:function(){return a||""},getResponseHeader:function(i){return i=i.toLowerCase(),Y||~D.inArray(i,["set-cookie","set-cookie2"])?null:a&&""!==a&&(aj||(aj={},D.each(a.split(/\r\n/),function(L){var u=L.split(/:\s+/);2===u.length&&(u[0]=D.trim(u[0]),aj[u[0].toLowerCase()]={header:u[0],value:D.trim(u[1])})})),aj.hasOwnProperty(i))?aj[i].header+": "+aj[i].value:null},overrideMimeType:function(L){var i,u;if(~D.inArray(ag("readyState"),[B.LOADING,B.DONE])){throw new I.DOMException(I.DOMException.INVALID_STATE_ERR)}if(L=D.trim(L.toLowerCase()),/;/.test(L)&&(i=L.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(L=i[1],i[2]&&(u=i[2])),!E.mimes[L]){throw new I.DOMException(I.DOMException.SYNTAX_ERR)}n=L,V=u},send:function(u,L){if(af="string"===D.typeOf(L)?{ruid:L}:L?L:{},this.readyState!==B.OPENED||ac){throw new I.DOMException(I.DOMException.INVALID_STATE_ERR)}if(u instanceof J){af.ruid=u.ruid,ab=u.type||"application/octet-stream"}else{if(u instanceof F){if(u.hasBlob()){var M=u.getBlob();af.ruid=M.ruid,ab=M.type||"application/octet-stream"}}else{"string"==typeof u&&(o="UTF-8",ab="text/plain;charset=UTF-8",u=x.utf8_encode(u))}}this.withCredentials||(this.withCredentials=af.required_caps&&af.required_caps.send_browser_cookies&&!ad),s=!p&&this.upload.hasEventListener(),Y=!1,r=!u,p||(ac=!0),Z.call(this,u)},abort:function(){if(Y=!0,p=!1,~D.inArray(ag("readyState"),[B.UNSENT,B.OPENED,B.DONE])){ag("readyState",B.UNSENT)}else{if(ag("readyState",B.DONE),ac=!1,!m){throw new I.DOMException(I.DOMException.INVALID_STATE_ERR)}m.getRuntime().exec.call(m,"XMLHttpRequest","abort",r),r=!0}},destroy:function(){m&&("function"===D.typeOf(m.destroy)&&m.destroy(),m=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(v.concat(["readystatechange"])),this.upload.handleEventProps(v)}var C={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};y.prototype=A.instance;var v=["loadstart","progress","abort","error","load","timeout","loadend"];return B.UNSENT=0,B.OPENED=1,B.HEADERS_RECEIVED=2,B.LOADING=3,B.DONE=4,B.prototype=A.instance,B}),k("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(o,l,a,p){function m(){function i(){r=t=0,v=this.result=null}function e(u,s){var z=this;x=s,z.bind("TransportingProgress",function(n){t=n.loaded,r>t&&-1===o.inArray(z.state,[m.IDLE,m.DONE])&&w.call(z)},999),z.bind("TransportingComplete",function(){t=r,z.state=m.DONE,v=null,z.result=x.exec.call(z,"Transporter","getAsBlob",u||"")},999),z.state=m.BUSY,z.trigger("TransportingStarted"),w.call(z)}function w(){var u,s=this,z=r-t;q>z&&(q=z),u=l.btoa(v.substr(t,q)),x.exec.call(s,"Transporter","receive",u,r)}var y,x,v,r,t,q;a.call(this),o.extend(this,{uid:o.guid("uid_"),state:m.IDLE,result:null,transport:function(A,z,B){var n=this;if(B=o.extend({chunk_size:204798},B),(y=B.chunk_size%3)&&(B.chunk_size+=3-y),q=B.chunk_size,i.call(this),v=A,r=A.length,"string"===o.typeOf(B)||B.ruid){e.call(n,z,this.connectRuntime(B))}else{var s=function(C,u){n.unbind("RuntimeInit",s),e.call(n,z,u)};this.bind("RuntimeInit",s),this.connectRuntime(B)}},abort:function(){var n=this;n.state=m.IDLE,x&&(x.exec.call(n,"Transporter","clear"),n.trigger("TransportingAborted")),i.call(n)},destroy:function(){this.unbindAll(),x=null,this.disconnectRuntime(),i.call(this)}})}return m.IDLE=0,m.BUSY=1,m.DONE=2,m.prototype=p.instance,m}),k("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(B,G,y,v,p,q,E,H,F,D,x,C,w){function z(){function m(o){try{return o||(o=this.exec("Image","getInfo")),this.size=o.size,this.width=o.width,this.height=o.height,this.type=o.type,this.meta=o.meta,""===this.name&&(this.name=o.name),!0}catch(n){return this.trigger("error",n.code),!1}}function l(o){var u=B.typeOf(o);try{if(o instanceof z){if(!o.size){throw new y.DOMException(y.DOMException.INVALID_STATE_ERR)}i.apply(this,arguments)}else{if(o instanceof x){if(!~B.inArray(o.type,["image/jpeg","image/png"])){throw new y.ImageError(y.ImageError.WRONG_FORMAT)}e.apply(this,arguments)}else{if(-1!==B.inArray(u,["blob","file"])){l.call(this,new C(null,o),arguments[1])}else{if("string"===u){"data:"===o.substr(0,5)?l.call(this,new x(null,{data:o}),arguments[1]):a.apply(this,arguments)}else{if("node"!==u||"img"!==o.nodeName.toLowerCase()){throw new y.DOMException(y.DOMException.TYPE_MISMATCH_ERR)}l.call(this,o.src,arguments[1])}}}}}catch(s){this.trigger("error",s.code)}}function i(r,o){var s=this.connectRuntime(r.ruid);this.ruid=s.uid,s.exec.call(this,"Image","loadFromImage",r,"undefined"===B.typeOf(o)?!0:o)}function e(s,o){function I(n){u.ruid=n.uid,n.exec.call(u,"Image","loadFromBlob",s)}var u=this;u.name=s.name||"",s.isDetached()?(this.bind("RuntimeInit",function(r,n){I(n)}),o&&"string"==typeof o.required_caps&&(o.required_caps=q.parseCaps(o.required_caps)),this.connectRuntime(B.extend({required_caps:{access_image_binary:!0,resize_image:!0}},o))):I(this.connectRuntime(s.ruid))}function a(s,r){var o,u=this;o=new p,o.open("get",s),o.responseType="blob",o.onprogress=function(n){u.trigger(n)},o.onload=function(){e.call(u,o.response,!0)},o.onerror=function(n){u.trigger(n)},o.onloadend=function(){o.destroy()},o.bind("RuntimeError",function(I,n){u.trigger("RuntimeError",n)}),o.send(null,r)}E.call(this),B.extend(this,{uid:B.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){l.apply(this,arguments)},resize:function(K){var P,M,N=this,I={x:0,y:0,width:N.width,height:N.height},L=B.extendIf({width:N.width,height:N.height,type:N.type||"image/jpeg",quality:90,crop:!1,fit:!0,preserveHeaders:!0,resample:"default",multipass:!0},K);try{if(!N.size){throw new y.DOMException(y.DOMException.INVALID_STATE_ERR)}if(N.width>z.MAX_RESIZE_WIDTH||N.height>z.MAX_RESIZE_HEIGHT){throw new y.ImageError(y.ImageError.MAX_RESOLUTION_ERR)}if(P=N.meta&&N.meta.tiff&&N.meta.tiff.Orientation||1,-1!==B.inArray(P,[5,6,7,8])){var J=L.width;L.width=L.height,L.height=J}if(L.crop){switch(M=Math.max(L.width/N.width,L.height/N.height),K.fit?(I.width=Math.min(Math.ceil(L.width/M),N.width),I.height=Math.min(Math.ceil(L.height/M),N.height),M=L.width/I.width):(I.width=Math.min(L.width,N.width),I.height=Math.min(L.height,N.height),M=1),"boolean"==typeof L.crop&&(L.crop="cc"),L.crop.toLowerCase().replace(/_/,"-")){case"rb":case"right-bottom":I.x=N.width-I.width,I.y=N.height-I.height;break;case"cb":case"center-bottom":I.x=Math.floor((N.width-I.width)/2),I.y=N.height-I.height;break;case"lb":case"left-bottom":I.x=0,I.y=N.height-I.height;break;case"lt":case"left-top":I.x=0,I.y=0;break;case"ct":case"center-top":I.x=Math.floor((N.width-I.width)/2),I.y=0;break;case"rt":case"right-top":I.x=N.width-I.width,I.y=0;break;case"rc":case"right-center":case"right-middle":I.x=N.width-I.width,I.y=Math.floor((N.height-I.height)/2);break;case"lc":case"left-center":case"left-middle":I.x=0,I.y=Math.floor((N.height-I.height)/2);break;case"cc":case"center-center":case"center-middle":default:I.x=Math.floor((N.width-I.width)/2),I.y=Math.floor((N.height-I.height)/2)}I.x=Math.max(I.x,0),I.y=Math.max(I.y,0)}else{M=Math.min(L.width/N.width,L.height/N.height)}this.exec("Image","resize",I,M,L)}catch(O){N.trigger("error",O.code)}},downsize:function(r){var o,s={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:"default"};o="object"==typeof r?B.extend(s,r):B.extend(s,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]}),this.resize(o)},crop:function(r,o,n){this.downsize(r,o,!0,n)},getAsCanvas:function(){if(!F.can("create_canvas")){throw new y.RuntimeError(y.RuntimeError.NOT_SUPPORTED_ERR)}return this.exec("Image","getAsCanvas")},getAsBlob:function(o,n){if(!this.size){throw new y.DOMException(y.DOMException.INVALID_STATE_ERR)}return this.exec("Image","getAsBlob",o||"image/jpeg",n||90)},getAsDataURL:function(o,n){if(!this.size){throw new y.DOMException(y.DOMException.INVALID_STATE_ERR)}return this.exec("Image","getAsDataURL",o||"image/jpeg",n||90)},getAsBinaryString:function(r,o){var n=this.getAsDataURL(r,o);return w.atob(n.substring(n.indexOf("base64,")+7))},embed:function(M,u){function K(N,P){var R=this;if(F.can("create_canvas")){var n=R.getAsCanvas();if(n){return M.appendChild(n),n=null,R.destroy(),L.trigger("embedded"),void 0}}var Q=R.getAsDataURL(N,P);if(!Q){throw new y.ImageError(y.ImageError.WRONG_FORMAT)}if(F.can("use_data_uri_of",Q.length)){M.innerHTML='<img src="'+Q+'" width="'+R.width+'" height="'+R.height+'" />',R.destroy(),L.trigger("embedded")}else{var O=new H;O.bind("TransportingComplete",function(){t=L.connectRuntime(this.result.ruid),L.bind("Embedded",function(){B.extend(t.getShimContainer().style,{top:"0px",left:"0px",width:R.width+"px",height:R.height+"px"}),t=null},999),t.exec.call(L,"ImageView","display",this.result.uid,width,height),R.destroy()}),O.transport(w.atob(Q.substring(Q.indexOf("base64,")+7)),N,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:M})}}var t,L=this,s=B.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},u);try{if(!(M=G.get(M))){throw new y.DOMException(y.DOMException.INVALID_NODE_TYPE_ERR)}if(!this.size){throw new y.DOMException(y.DOMException.INVALID_STATE_ERR)}this.width>z.MAX_RESIZE_WIDTH||this.height>z.MAX_RESIZE_HEIGHT;var J=new z;return J.bind("Resize",function(){K.call(this,s.type,s.quality)}),J.bind("Load",function(){this.downsize(s)}),this.meta.thumb&&this.meta.thumb.width>=s.width&&this.meta.thumb.height>=s.height?J.load(this.meta.thumb.data):J.clone(this,!1),J}catch(I){this.trigger("error",I.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.meta&&this.meta.thumb&&this.meta.thumb.data.destroy(),this.unbindAll()}}),this.handleEventProps(A),this.bind("Load Resize",function(){return m.call(this)},999)}var A=["progress","load","error","resize","embedded"];return z.MAX_RESIZE_WIDTH=8192,z.MAX_RESIZE_HEIGHT=8192,z.prototype=D.instance,z}),k("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(r,p,m,v){function u(i){var n=this,e=m.capTest,s=m.capTrue,a=r.extend({access_binary:e(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return n.can("access_binary")&&!!q.Image},display_media:e((v.can("create_canvas")||v.can("use_data_uri_over32kb"))&&g("moxie/image/Image")),do_cors:e(window.XMLHttpRequest&&"withCredentials" in new XMLHttpRequest),drag_and_drop:e(function(){var o=document.createElement("div");return("draggable" in o||"ondragstart" in o&&"ondrop" in o)&&("IE"!==v.browser||v.verComp(v.version,9,">"))}()),filter_by_extension:e(function(){return !("Chrome"===v.browser&&v.verComp(v.version,28,"<")||"IE"===v.browser&&v.verComp(v.version,10,"<")||"Safari"===v.browser&&v.verComp(v.version,7,"<")||"Firefox"===v.browser&&v.verComp(v.version,37,"<"))}()),return_response_headers:s,return_response_type:function(o){return"json"===o&&window.JSON?!0:v.can("return_response_type",o)},return_status_code:s,report_upload_progress:e(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return n.can("access_binary")&&v.can("create_canvas")},select_file:function(){return v.can("use_fileinput")&&window.File},select_folder:function(){return n.can("select_file")&&("Chrome"===v.browser&&v.verComp(v.version,21,">=")||"Firefox"===v.browser&&v.verComp(v.version,42,">="))},select_multiple:function(){return !(!n.can("select_file")||"Safari"===v.browser&&"Windows"===v.os||"iOS"===v.os&&v.verComp(v.osVersion,"7.0.0",">")&&v.verComp(v.osVersion,"8.0.0","<"))},send_binary_string:e(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:e(window.XMLHttpRequest),send_multipart:function(){return !!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||n.can("send_binary_string")},slice_blob:e(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return n.can("slice_blob")&&n.can("send_multipart")},summon_file_dialog:function(){return n.can("select_file")&&("Firefox"===v.browser&&v.verComp(v.version,4,">=")||"Opera"===v.browser&&v.verComp(v.version,12,">=")||"IE"===v.browser&&v.verComp(v.version,10,">=")||!!~r.inArray(v.browser,["Chrome","Safari","Edge"]))},upload_filesize:s,use_http_method:s},arguments[2]);m.call(this,i,arguments[1]||l,a),r.extend(this,{init:function(){this.trigger("Init")},destroy:function(o){return function(){o.call(n),o=n=null}}(this.destroy)}),r.extend(this.getShim(),q)}var l="html5",q={};return m.addConstructor(l,u),q}),k("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(m,l){function a(){function i(s,p,o){var u;if(!window.File.prototype.slice){return(u=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?u.call(s,p,o):null}try{return s.slice(),s.slice(p,o)}catch(q){return s.slice(p,o-p)}}this.slice=function(){return new l(this.getRuntime().uid,i.apply(this,arguments))}}return m.Blob=a}),k("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(v){function p(){this.returnValue=!1}function m(){this.cancelBubble=!0}var x={},u="moxie_"+v.guid(),w=function(t,i,r,n){var y,e;i=i.toLowerCase(),t.addEventListener?(y=r,t.addEventListener(i,y,!1)):t.attachEvent&&(y=function(){var a=window.event;a.target||(a.target=a.srcElement),a.preventDefault=p,a.stopPropagation=m,r(a)},t.attachEvent("on"+i,y)),t[u]||(t[u]=v.guid()),x.hasOwnProperty(t[u])||(x[t[u]]={}),e=x[t[u]],e.hasOwnProperty(i)||(e[i]=[]),e[i].push({func:y,orig:r,key:n})},l=function(y,r,A){var e,z;if(r=r.toLowerCase(),y[u]&&x[y[u]]&&x[y[u]][r]){e=x[y[u]][r];for(var n=e.length-1;n>=0&&(e[n].orig!==A&&e[n].key!==A||(y.removeEventListener?y.removeEventListener(r,e[n].func,!1):y.detachEvent&&y.detachEvent("on"+r,e[n].func),e[n].orig=null,e[n].func=null,e.splice(n,1),A===z));n--){}if(e.length||delete x[y[u]][r],v.isEmptyObj(x[y[u]])){delete x[y[u]];try{delete y[u]}catch(B){y[u]=z}}}},q=function(e,a){e&&e[u]&&v.each(x[e[u]],function(i,o){l(e,o,a)})};return{addEvent:w,removeEvent:l,removeAllEvents:q}}),k("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(v,p,m,x,u,w,l){function q(){var i,a;m.extend(this,{init:function(B){var z,o,y,n,r,t,e=this,s=e.getRuntime();i=B,y=i.accept.mimes||w.extList2mimes(i.accept,s.can("filter_by_extension")),o=s.getShimContainer(),o.innerHTML='<input id="'+s.uid+'" type="file" style="font-size:999px;opacity:0;"'+(i.multiple&&s.can("select_multiple")?"multiple":"")+(i.directory&&s.can("select_folder")?"webkitdirectory directory":"")+(y?' accept="'+y.join(",")+'"':"")+" />",z=x.get(s.uid),m.extend(z.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),n=x.get(i.browse_button),a=x.getStyle(n,"z-index")||"auto",s.can("summon_file_dialog")&&("static"===x.getStyle(n,"position")&&(n.style.position="relative"),u.addEvent(n,"click",function(D){var C=x.get(s.uid);C&&!C.disabled&&C.click(),D.preventDefault()},e.uid),e.bind("Refresh",function(){r=parseInt(a,10)||1,x.get(i.browse_button).style.zIndex=r,this.getRuntime().getShimContainer().style.zIndex=r-1})),t=s.can("summon_file_dialog")?n:o,u.addEvent(t,"mouseover",function(){e.trigger("mouseenter")},e.uid),u.addEvent(t,"mouseout",function(){e.trigger("mouseleave")},e.uid),u.addEvent(t,"mousedown",function(){e.trigger("mousedown")},e.uid),u.addEvent(x.get(i.container),"mouseup",function(){e.trigger("mouseup")},e.uid),z.onchange=function A(){if(e.files=[],m.each(this.files,function(D){var E="";return i.directory&&"."==D.name?!0:(D.webkitRelativePath&&(E="/"+D.webkitRelativePath.replace(/^\//,"")),D=new p(s.uid,D),D.relativePath=E,e.files.push(D),void 0)}),"IE"!==l.browser&&"IEMobile"!==l.browser){this.value=""}else{var C=this.cloneNode(!0);this.parentNode.replaceChild(C,this),C.onchange=A}e.files.length&&e.trigger("change")},e.trigger({type:"ready",async:!0}),o=null},setOption:function(z,s){var o=this.getRuntime(),y=x.get(o.uid);switch(z){case"accept":if(s){var n=s.mimes||w.extList2mimes(s,o.can("filter_by_extension"));y.setAttribute("accept",n.join(","))}else{y.removeAttribute("accept")}break;case"directory":s&&o.can("select_folder")?(y.setAttribute("directory",""),y.setAttribute("webkitdirectory","")):(y.removeAttribute("directory"),y.removeAttribute("webkitdirectory"));break;case"multiple":s&&o.can("select_multiple")?y.setAttribute("multiple",""):y.removeAttribute("multiple")}},disable:function(r){var o,n=this.getRuntime();(o=x.get(n.uid))&&(o.disabled=!!r)},destroy:function(){var s=this.getRuntime(),r=s.getShim(),y=s.getShimContainer(),e=i&&x.get(i.container),n=i&&x.get(i.browse_button);e&&u.removeAllEvents(e,this.uid),n&&(u.removeAllEvents(n,this.uid),n.style.zIndex=a),y&&(u.removeAllEvents(y,this.uid),y.innerHTML=""),r.removeInstance(this.uid),i=y=e=n=r=null}})}return v.FileInput=q}),k("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(s,p,m,v,q,u){function l(){function x(D){if(!D.dataTransfer||!D.dataTransfer.types){return !1}var a=m.toArray(D.dataTransfer.types||[]);return -1!==m.inArray("Files",a)||-1!==m.inArray("public.file-url",a)||-1!==m.inArray("application/x-moz-file",a)}function A(D,a){if(B(D)){var E=new p(w,D);E.relativePath=a||"",i.push(E)}}function C(D){for(var a=[],E=0;E<D.length;E++){[].push.apply(a,D[E].extensions.split(/\s*,\s*/))}return -1===m.inArray("*",a)?a:[]}function B(D){if(!t.length){return !0}var a=u.getFileExtension(D.name);return !a||-1!==m.inArray(a,t)}function z(D,a){var E=[];m.each(D,function(G){var F=G.webkitGetAsEntry();F&&(F.isFile?A(G.getAsFile(),F.fullPath):E.push(F))}),E.length?o(E,a):a()}function o(D,a){var E=[];m.each(D,function(F){E.push(function(e){y(F,e)})}),m.inSeries(E,function(){a()})}function y(D,a){D.isFile?D.file(function(e){A(e,D.fullPath),a()},function(){a()}):D.isDirectory?n(D,a):a()}function n(F,D){function a(H){E.readEntries(function(e){e.length?([].push.apply(G,e),a(H)):H()},H)}var G=[],E=F.createReader();a(function(){o(G,D)})}var r,w,i=[],t=[];m.extend(this,{init:function(a){var D,e=this;r=a,w=e.ruid,t=C(r.accept),D=r.container,q.addEvent(D,"dragover",function(E){x(E)&&(E.preventDefault(),E.dataTransfer.dropEffect="copy")},e.uid),q.addEvent(D,"drop",function(E){x(E)&&(E.preventDefault(),i=[],E.dataTransfer.items&&E.dataTransfer.items[0].webkitGetAsEntry?z(E.dataTransfer.items,function(){e.files=i,e.trigger("drop")}):(m.each(E.dataTransfer.files,function(F){A(F)}),e.files=i,e.trigger("drop")))},e.uid),q.addEvent(D,"dragenter",function(){e.trigger("dragenter")},e.uid),q.addEvent(D,"dragleave",function(){e.trigger("dragleave")},e.uid)},destroy:function(){q.removeAllEvents(r&&v.get(r.container),this.uid),w=i=t=r=null}})}return s.FileDrop=l}),k("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(m,l,a){function o(){function p(n){return l.atob(n.substring(n.indexOf("base64,")+7))}var q,i=!1;a.extend(this,{read:function(n,r){var e=this;e.result="",q=new window.FileReader,q.addEventListener("progress",function(s){e.trigger(s)}),q.addEventListener("load",function(s){e.result=i?p(q.result):q.result,e.trigger(s)}),q.addEventListener("error",function(s){e.trigger(s,q.error)}),q.addEventListener("loadend",function(s){q=null,e.trigger(s)}),"function"===a.typeOf(q[n])?(i=!1,q[n](r.getSource())):"readAsBinaryString"===n&&(i=!0,q.readAsDataURL(r.getSource()))},abort:function(){q&&q.abort()},destroy:function(){q=null}})}return m.FileReader=o}),k("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(v,z,q,p,l,m,x,A,y){function w(){function r(D,B){var u,E,C=this;u=B.getBlob().getSource(),E=new window.FileReader,E.onload=function(){B.append(B.getBlobName(),new m(null,{type:u.type,data:E.result})),o.send.call(C,D,B)},E.readAsBinaryString(u)}function t(){return !window.XMLHttpRequest||"IE"===y.browser&&y.verComp(y.version,8,"<")?function(){for(var C=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],B=0;B<C.length;B++){try{return new ActiveXObject(C[B])}catch(u){}}}():new window.XMLHttpRequest}function i(C){var B=C.responseXML,u=C.responseText;return"IE"===y.browser&&u&&B&&!B.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(C.getResponseHeader("Content-Type"))&&(B=new window.ActiveXObject("Microsoft.XMLDOM"),B.async=!1,B.validateOnParse=!1,B.loadXML(u)),B&&("IE"===y.browser&&0!==B.parseError||!B.documentElement||"parsererror"===B.documentElement.tagName)?null:B}function s(E){var C="----moxieboundary"+(new Date).getTime(),B="--",F="\r\n",D="",u=this.getRuntime();if(!u.can("send_binary_string")){throw new A.RuntimeError(A.RuntimeError.NOT_SUPPORTED_ERR)}return a.setRequestHeader("Content-Type","multipart/form-data; boundary="+C),E.each(function(H,G){D+=H instanceof m?B+C+F+'Content-Disposition: form-data; name="'+G+'"; filename="'+unescape(encodeURIComponent(H.name||"blob"))+'"'+F+"Content-Type: "+(H.type||"application/octet-stream")+F+F+H.getSource()+F:B+C+F+'Content-Disposition: form-data; name="'+G+'"'+F+F+unescape(encodeURIComponent(H))+F}),D+=B+C+B+F}var a,n,o=this;z.extend(this,{send:function(u,D){var B=this,e="Mozilla"===y.browser&&y.verComp(y.version,4,">=")&&y.verComp(y.version,7,"<"),E="Android Browser"===y.browser,F=!1;if(n=u.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),a=t(),a.open(u.method,u.url,u.async,u.user,u.password),D instanceof m){D.isDetached()&&(F=!0),D=D.getSource()}else{if(D instanceof x){if(D.hasBlob()){if(D.getBlob().isDetached()){D=s.call(B,D),F=!0}else{if((e||E)&&"blob"===z.typeOf(D.getBlob().getSource())&&window.FileReader){return r.call(B,u,D),void 0}}}if(D instanceof x){var C=new window.FormData;D.each(function(H,G){H instanceof m?C.append(G,H.getSource()):C.append(G,H)}),D=C}}}a.upload?(u.withCredentials&&(a.withCredentials=!0),a.addEventListener("load",function(G){B.trigger(G)}),a.addEventListener("error",function(G){B.trigger(G)}),a.addEventListener("progress",function(G){B.trigger(G)}),a.upload.addEventListener("progress",function(G){B.trigger({type:"UploadProgress",loaded:G.loaded,total:G.total})})):a.onreadystatechange=function(){switch(a.readyState){case 1:break;case 2:break;case 3:var I,G;try{p.hasSameOrigin(u.url)&&(I=a.getResponseHeader("Content-Length")||0),a.responseText&&(G=a.responseText.length)}catch(H){I=G=0}B.trigger({type:"progress",lengthComputable:!!I,total:parseInt(I,10),loaded:G});break;case 4:a.onreadystatechange=function(){},0===a.status?B.trigger("error"):B.trigger("load")}},z.isEmptyObj(u.headers)||z.each(u.headers,function(H,G){a.setRequestHeader(G,H)}),""!==u.responseType&&"responseType" in a&&(a.responseType="json"!==u.responseType||y.can("return_response_type","json")?u.responseType:"text"),F?a.sendAsBinary?a.sendAsBinary(D):function(){for(var H=new Uint8Array(D.length),G=0;G<D.length;G++){H[G]=255&D.charCodeAt(G)}a.send(H.buffer)}():a.send(D),B.trigger("loadstart")},getStatus:function(){try{if(a){return a.status}}catch(u){}return 0},getResponse:function(D){var B=this.getRuntime();try{switch(D){case"blob":var F=new l(B.uid,a.response),E=a.getResponseHeader("Content-Disposition");if(E){var u=E.match(/filename=([\'\"'])([^\1]+)\1/);u&&(n=u[2])}return F.name=n,F.type||(F.type=q.getFileMime(n)),F;case"json":return y.can("return_response_type","json")?a.response:200===a.status&&window.JSON?JSON.parse(a.responseText):null;case"document":return i(a);default:return""!==a.responseText?a.responseText:null}}catch(C){return null}},getAllResponseHeaders:function(){try{return a.getAllResponseHeaders()}catch(u){}return""},abort:function(){a&&a.abort()},destroy:function(){o=n=null}})}return v.XMLHttpRequest=w}),k("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(m){function l(i){i instanceof ArrayBuffer?a.apply(this,arguments):o.apply(this,arguments)}function a(n){var e=new DataView(n);m.extend(this,{readByteAt:function(i){return e.getUint8(i)},writeByteAt:function(p,i){e.setUint8(p,i)},SEGMENT:function(p,s,i){switch(arguments.length){case 2:return n.slice(p,p+s);case 1:return n.slice(p);case 3:if(null===i&&(i=new ArrayBuffer),i instanceof ArrayBuffer){var q=new Uint8Array(this.length()-s+i.byteLength);p>0&&q.set(new Uint8Array(n.slice(0,p)),0),q.set(new Uint8Array(i),p),q.set(new Uint8Array(n.slice(p+s)),p+i.byteLength),this.clear(),n=q.buffer,e=new DataView(n);break}default:return n}},length:function(){return n?n.byteLength:0},clear:function(){e=n=null}})}function o(n){function e(q,p,r){r=3===arguments.length?r:n.length-p-1,n=n.substr(0,p)+q+n.substr(r+p)}m.extend(this,{readByteAt:function(i){return n.charCodeAt(i)},writeByteAt:function(p,i){e(String.fromCharCode(i),p,1)},SEGMENT:function(p,q,i){switch(arguments.length){case 1:return n.substr(p);case 2:return n.substr(p,q);case 3:e(null!==i?i:"",p,q);break;default:return n}},length:function(){return n?n.length:0},clear:function(){n=null}})}return m.extend(l.prototype,{littleEndian:!1,read:function(u,q){var p,v,s;if(u+q>this.length()){throw new Error("You are trying to read outside the source boundaries.")}for(v=this.littleEndian?0:-8*(q-1),s=0,p=0;q>s;s++){p|=this.readByteAt(u+s)<<Math.abs(v+8*s)}return p},write:function(u,q,p){var v,s;if(u>this.length()){throw new Error("You are trying to write outside the source boundaries.")}for(v=this.littleEndian?0:-8*(p-1),s=0;p>s;s++){this.writeByteAt(u+s,255&q>>Math.abs(v+8*s))}},BYTE:function(i){return this.read(i,1)},SHORT:function(i){return this.read(i,2)},LONG:function(i){return this.read(i,4)},SLONG:function(n){var i=this.read(n,4);return i>2147483647?i-4294967296:i},CHAR:function(i){return String.fromCharCode(this.read(i,1))},STRING:function(n,i){return this.asArray("CHAR",n,i).join("")},asArray:function(u,q,p){for(var v=[],s=0;p>s;s++){v[s]=this[u](q+s)}return v}}),l}),k("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(m,l){return function a(v){var q,t,e,p=[],i=0;if(q=new m(v),65496!==q.SHORT(0)){throw q.clear(),new l.ImageError(l.ImageError.WRONG_FORMAT)}for(t=2;t<=q.length();){if(e=q.SHORT(t),e>=65488&&65495>=e){t+=2}else{if(65498===e||65497===e){break}i=q.SHORT(t+2)+2,e>=65505&&65519>=e&&p.push({hex:e,name:"APP"+(15&e),start:t,length:i,segment:q.SEGMENT(t,i)}),t+=i}}return q.clear(),{headers:p,restore:function(s){var o,w,u;for(u=new m(s),t=65504==u.SHORT(2)?4+u.SHORT(4):2,w=0,o=p.length;o>w;w++){u.SEGMENT(t,0,p[w].segment),t+=p[w].length}return s=u.SEGMENT(),u.clear(),s},strip:function(u){var y,w,x,s;for(x=new a(u),w=x.headers,x.purge(),y=new m(u),s=w.length;s--;){y.SEGMENT(w[s].start,w[s].length,"")}return u=y.SEGMENT(),y.clear(),u},get:function(s){for(var r=[],o=0,u=p.length;u>o;o++){p[o].name===s.toUpperCase()&&r.push(p[o].segment)}return r},set:function(x,u){var s,z,w,y=[];for("string"==typeof u?y.push(u):y=u,s=z=0,w=p.length;w>s&&(p[s].name===x.toUpperCase()&&(p[s].segment=y[z],p[s].length=y[z].length,z++),!(z>=y.length));s++){}},purge:function(){this.headers=p=[]}}}}),k("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(m,a,o){function l(e){function v(C,y){var A,I,M,L,G,B,D,F,z=this,E=[],H={},K={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},J={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(A=z.SHORT(C),I=0;A>I;I++){if(E=[],D=C+2+12*I,M=y[z.SHORT(D)],M!==d){if(L=K[z.SHORT(D+=2)],G=z.LONG(D+=2),B=J[L],!B){throw new o.ImageError(o.ImageError.INVALID_META_ERR)}if(D+=4,B*G>4&&(D=z.LONG(D)+r.tiffHeader),D+B*G>=this.length()){throw new o.ImageError(o.ImageError.INVALID_META_ERR)}"ASCII"!==L?(E=z.asArray(L,D,G),F=1==G?E[0]:E,H[M]=n.hasOwnProperty(M)&&"object"!=typeof F?n[M][F]:F):H[M]=m.trim(z.STRING(D,G).replace(/\0$/,""))}}return H}function x(E,H,D){var A,y,z,F=0;if("string"==typeof H){var I=t[E.toLowerCase()];for(var G in I){if(I[G]===H){H=G;break}}}A=r[E.toLowerCase()+"IFD"],y=this.SHORT(A);for(var C=0;y>C;C++){if(z=A+12*C+2,this.SHORT(z)==H){F=z+8;break}}if(!F){return !1}try{this.write(F,D,4)}catch(B){return !1}return !0}var w,t,n,r,i,p;if(a.call(this,e),t={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}},n={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},r={tiffHeader:10},i=r.tiffHeader,w={clear:this.clear},m.extend(this,{read:function(){try{return l.prototype.read.apply(this,arguments)}catch(s){throw new o.ImageError(o.ImageError.INVALID_META_ERR)}},write:function(){try{return l.prototype.write.apply(this,arguments)}catch(s){throw new o.ImageError(o.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(s){return this.LONG(s)/this.LONG(s+4)},SRATIONAL:function(s){return this.SLONG(s)/this.SLONG(s+4)},ASCII:function(s){return this.CHAR(s)},TIFF:function(){return p||null},EXIF:function(){var u=null;if(r.exifIFD){try{u=v.call(this,r.exifIFD,t.exif)}catch(s){return null}if(u.ExifVersion&&"array"===m.typeOf(u.ExifVersion)){for(var z=0,y="";z<u.ExifVersion.length;z++){y+=String.fromCharCode(u.ExifVersion[z])}u.ExifVersion=y}}return u},GPS:function(){var u=null;if(r.gpsIFD){try{u=v.call(this,r.gpsIFD,t.gps)}catch(s){return null}u.GPSVersionID&&"array"===m.typeOf(u.GPSVersionID)&&(u.GPSVersionID=u.GPSVersionID.join("."))}return u},thumb:function(){if(r.IFD1){try{var u=v.call(this,r.IFD1,t.thumb);if("JPEGInterchangeFormat" in u){return this.SEGMENT(r.tiffHeader+u.JPEGInterchangeFormat,u.JPEGInterchangeFormatLength)}}catch(s){}}return null},setExif:function(u,s){return"PixelXDimension"!==u&&"PixelYDimension"!==u?!1:x.call(this,"exif",u,s)},clear:function(){w.clear(),e=t=n=p=r=w=null}}),65505!==this.SHORT(0)||"EXIF\0"!==this.STRING(4,5).toUpperCase()){throw new o.ImageError(o.ImageError.INVALID_META_ERR)}if(this.littleEndian=18761==this.SHORT(i),42!==this.SHORT(i+=2)){throw new o.ImageError(o.ImageError.INVALID_META_ERR)}r.IFD0=r.tiffHeader+this.LONG(i+=2),p=v.call(this,r.IFD0,t.tiff),"ExifIFDPointer" in p&&(r.exifIFD=r.tiffHeader+p.ExifIFDPointer,delete p.ExifIFDPointer),"GPSInfoIFDPointer" in p&&(r.gpsIFD=r.tiffHeader+p.GPSInfoIFDPointer,delete p.GPSInfoIFDPointer),m.isEmptyObj(p)&&(p=null);var q=this.LONG(r.IFD0+12*this.SHORT(r.IFD0)+2);q&&(r.IFD1=r.tiffHeader+q)}return l.prototype=a.prototype,l}),k("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(p,l,a,s,m){function q(e){function w(z){var u,o,A=0;for(z||(z=v);A<=z.length();){if(u=z.SHORT(A+=2),u>=65472&&65475>=u){return A+=5,{height:z.SHORT(A),width:z.SHORT(A+=2)}}o=z.SHORT(A+=2),A+=o-2}return null}function y(){var z,u,o=t.thumb();return o&&(z=new s(o),u=w(z),z.clear(),u)?(u.data=o,u):null}function x(){t&&n&&v&&(t.clear(),n.purge(),v.clear(),i=n=t=v=null)}var v,n,t,i;if(v=new s(e),65496!==v.SHORT(0)){throw new l.ImageError(l.ImageError.WRONG_FORMAT)}n=new a(e);try{t=new m(n.get("app1")[0])}catch(r){}i=w.call(this),p.extend(this,{type:"image/jpeg",size:v.length(),width:i&&i.width||0,height:i&&i.height||0,setExif:function(u,o){return t?("object"===p.typeOf(u)?p.each(u,function(A,z){t.setExif(z,A)}):t.setExif(u,o),n.set("app1",t.SEGMENT()),void 0):!1},writeHeaders:function(){return arguments.length?n.restore(arguments[0]):n.restore(e)},stripHeaders:function(o){return n.strip(o)},purge:function(){x.call(this)}}),t&&(this.meta={tiff:t.TIFF(),exif:t.EXIF(),gps:t.GPS(),thumb:y()})}return q}),k("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(m,l,a){function o(x){function t(){var r,n;return r=i.call(this,8),"IHDR"==r.type?(n=r.start,{width:q.LONG(n),height:q.LONG(n+=4)}):null}function v(){q&&(q.clear(),x=e=p=w=q=null)}function i(z){var u,s,A,y;return u=q.LONG(z),s=q.STRING(z+=4,4),A=z+=4,y=q.LONG(z+u),{length:u,type:s,start:A,CRC:y}}var q,p,w,e;q=new a(x),function(){var s=0,r=0,u=[35152,20039,3338,6666];for(r=0;r<u.length;r++,s+=2){if(u[r]!=q.SHORT(s)){throw new m.ImageError(m.ImageError.WRONG_FORMAT)}}}(),e=t.call(this),l.extend(this,{type:"image/png",size:q.length(),width:e.width,height:e.height,purge:function(){v.call(this)}}),v.call(this)}return o}),k("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(m,l,a,o){return function(i){var n,e=[a,o];n=function(){for(var q=0;q<e.length;q++){try{return new e[q](i)}catch(p){}}throw new l.ImageError(l.ImageError.WRONG_FORMAT)}(),m.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(p){return p},stripHeaders:function(p){return p},purge:function(){i=null}}),m.extend(this,n),this.purge=function(){n.purge(),n=null}}}),k("moxie/runtime/html5/image/ResizerCanvas",[],function(){function i(l,t){var p=l.width,q=Math.floor(p*t),e=!1;(0.5>t||t>2)&&(t=0.5>t?0.5:2,e=!0);var m=a(l,t);return e?i(m,q/m.width):m}function a(s,p){var m=s.width,v=s.height,q=Math.floor(m*p),u=Math.floor(v*p),l=document.createElement("canvas");return l.width=q,l.height=u,l.getContext("2d").drawImage(s,0,0,m,v,0,0,q,u),s=null,l}return{scale:i}}),k("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/Blob","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/ResizerCanvas","moxie/core/utils/Mime","moxie/core/utils/Env"],function(v,z,q,p,l,m,x,A,y){function w(){function u(){if(!I&&!s){throw new q.ImageError(q.DOMException.INVALID_STATE_ERR)}return I||s}function C(){var e=u();return"canvas"==e.nodeName.toLowerCase()?e:(I=document.createElement("canvas"),I.width=e.width,I.height=e.height,I.getContext("2d").drawImage(e,0,0),I)}function n(E){return p.atob(E.substring(E.indexOf("base64,")+7))}function B(K,E){return"data:"+(E||"")+";base64,"+p.btoa(K)}function i(K){var E=this;s=new Image,s.onerror=function(){a.call(this),E.trigger("error",q.ImageError.WRONG_FORMAT)},s.onload=function(){E.trigger("load")},s.src="data:"==K.substr(0,5)?K:B(K,F.type)}function r(L,E){var M,K=this;return window.FileReader?(M=new FileReader,M.onload=function(){E.call(K,this.result)},M.onerror=function(){K.trigger("error",q.ImageError.WRONG_FORMAT)},M.readAsDataURL(L),void 0):E.call(this,L.getAsDataURL())}function t(N,K){var P=Math.PI/180,M=document.createElement("canvas"),O=M.getContext("2d"),E=N.width,L=N.height;switch(z.inArray(K,[5,6,7,8])>-1?(M.width=L,M.height=E):(M.width=E,M.height=L),K){case 2:O.translate(E,0),O.scale(-1,1);break;case 3:O.translate(E,L),O.rotate(180*P);break;case 4:O.translate(0,L),O.scale(1,-1);break;case 5:O.rotate(90*P),O.scale(1,-1);break;case 6:O.rotate(90*P),O.translate(0,-L);break;case 7:O.rotate(90*P),O.translate(E,-L),O.scale(-1,1);break;case 8:O.rotate(-90*P),O.translate(-E,0)}return O.drawImage(N,0,0,E,L),M}function a(){G&&(G.purge(),G=null),H=s=I=F=null,D=!1}var s,G,I,H,F,J=this,D=!1,o=!0;z.extend(this,{loadFromBlob:function(K){var E=this.getRuntime(),L=arguments.length>1?arguments[1]:!0;if(!E.can("access_binary")){throw new q.RuntimeError(q.RuntimeError.NOT_SUPPORTED_ERR)}return F=K,K.isDetached()?(H=K.getSource(),i.call(this,H),void 0):(r.call(this,K.getSource(),function(M){L&&(H=n(M)),i.call(this,M)}),void 0)},loadFromImage:function(K,E){this.meta=K.meta,F=new m(null,{name:K.name,size:K.size,type:K.type}),i.call(this,E?H=K.getAsBinaryString():K.getAsDataURL())},getInfo:function(){var E,e=this.getRuntime();return !G&&H&&e.can("access_image_binary")&&(G=new x(H)),E={width:u().width||0,height:u().height||0,type:F.type||y.getFileMime(F.name),size:H&&H.length||F.size||0,name:F.name||"",meta:null},o&&(E.meta=G&&G.meta||this.meta||{},!E.meta||!E.meta.thumb||E.meta.thumb.data instanceof l||(E.meta.thumb.data=new l(null,{type:"image/jpeg",data:E.meta.thumb.data}))),E},resize:function(E,e,M){var K=document.createElement("canvas");if(K.width=E.width,K.height=E.height,K.getContext("2d").drawImage(u(),E.x,E.y,E.width,E.height,0,0,K.width,K.height),I=A.scale(K,e),o=M.preserveHeaders,!o){var L=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;I=t(I,L)}this.width=I.width,this.height=I.height,D=!0,this.trigger("Resize")},getAsCanvas:function(){return I||(I=C()),I.id=this.uid+"_canvas",I},getAsBlob:function(K,E){return K!==this.type?(D=!0,new m(null,{name:F.name||"",type:K,data:J.getAsDataURL(K,E)})):new m(null,{name:F.name||"",type:K,data:J.getAsBinaryString(K,E)})},getAsDataURL:function(L){var K=arguments[1]||90;if(!D){return s.src}if(C(),"image/jpeg"!==L){return I.toDataURL("image/png")}try{return I.toDataURL("image/jpeg",K/100)}catch(E){return I.toDataURL("image/jpeg")}},getAsBinaryString:function(L,K){if(!D){return H||(H=n(J.getAsDataURL(L,K))),H}if("image/jpeg"!==L){H=n(J.getAsDataURL(L,K))}else{var E;K||(K=90),C();try{E=I.toDataURL("image/jpeg",K/100)}catch(M){E=I.toDataURL("image/jpeg")}H=n(E),G&&(H=G.stripHeaders(H),o&&(G.meta&&G.meta.exif&&G.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),H=G.writeHeaders(H)),G.purge(),G=null)}return D=!1,H},destroy:function(){J=null,a.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return v.Image=w}),k("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(v,A,r,p,m){function y(){var n;try{n=navigator.plugins["Shockwave Flash"],n=n.description}catch(l){try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(a){n="0.0"}}return n=n.match(/\d+/g),parseFloat(n[0]+"."+n[1])}function B(i){var l=r.get(i);l&&"OBJECT"==l.nodeName&&("IE"===A.browser?(l.style.display="none",function a(){4==l.readyState?z(i):setTimeout(a,10)}()):l.parentNode.removeChild(l))}function z(i){var a=r.get(i);if(a){for(var l in a){"function"==typeof a[l]&&(a[l]=null)}a.parentNode.removeChild(a)}}function x(e){var i,a=this;e=v.extend({swf_url:A.swf_url},e),m.call(this,e,q,{access_binary:function(l){return l&&"browser"===a.mode},access_image_binary:function(l){return l&&"browser"===a.mode},display_media:m.capTest(g("moxie/image/Image")),do_cors:m.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===a.mode},resize_image:m.capTrue,return_response_headers:!1,return_response_type:function(l){return"json"===l&&window.JSON?!0:!v.arrayDiff(l,["","text","document"])||"browser"===a.mode},return_status_code:function(l){return"browser"===a.mode||!v.arrayDiff(l,[200,404])},select_file:m.capTrue,select_multiple:m.capTrue,send_binary_string:function(l){return l&&"browser"===a.mode},send_browser_cookies:function(l){return l&&"browser"===a.mode},send_custom_headers:function(l){return l&&"browser"===a.mode},send_multipart:m.capTrue,slice_blob:function(l){return l&&"browser"===a.mode},stream_upload:function(l){return l&&"browser"===a.mode},summon_file_dialog:!1,upload_filesize:function(l){return v.parseSizeStr(l)<=2097152||"client"===a.mode},use_http_method:function(l){return !v.arrayDiff(l,["GET","POST"])}},{access_binary:function(l){return l?"browser":"client"},access_image_binary:function(l){return l?"browser":"client"},report_upload_progress:function(l){return l?"browser":"client"},return_response_type:function(l){return v.arrayDiff(l,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(l){return v.arrayDiff(l,[200,404])?"browser":["client","browser"]},send_binary_string:function(l){return l?"browser":"client"},send_browser_cookies:function(l){return l?"browser":"client"},send_custom_headers:function(l){return l?"browser":"client"},slice_blob:function(l){return l?"browser":"client"},stream_upload:function(l){return l?"client":"browser"},upload_filesize:function(l){return v.parseSizeStr(l)>=2097152?"client":"browser"}},"client"),y()<11.3&&(this.mode=!1),v.extend(this,{getShim:function(){return r.get(this.uid)},shimExec:function(o,n){var l=[].slice.call(arguments,2);return a.getShim().exec(this.uid,o,n,l)},init:function(){var l,n,s;s=this.getShimContainer(),v.extend(s.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),l='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+e.swf_url+'" ',"IE"===A.browser&&(l+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),l+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+e.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+A.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===A.browser?(n=document.createElement("div"),s.appendChild(n),n.outerHTML=l,n=s=null):s.innerHTML=l,i=setTimeout(function(){a&&!a.initialized&&a.trigger("Error",new p.RuntimeError(p.RuntimeError.NOT_INIT_ERR))},5000)},destroy:function(l){return function(){B(a.uid),l.call(a),clearTimeout(i),e=i=l=a=null}}(this.destroy)},w)}var q="flash",w={};return m.addConstructor(q,x),w}),k("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(m,l){var a={slice:function(s,p,u,q){var t=this.getRuntime();return 0>p?p=Math.max(s.size+p,0):p>0&&(p=Math.min(p,s.size)),0>u?u=Math.max(s.size+u,0):u>0&&(u=Math.min(u,s.size)),s=t.shimExec.call(this,"Blob","slice",p,u,q||""),s&&(s=new l(t.uid,s)),s}};return m.Blob=a}),k("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(m,l,a){var o={init:function(p){var q=this,i=this.getRuntime();this.bind("Change",function(){var n=i.shimExec.call(q,"FileInput","getFiles");q.files=[],a.each(n,function(r){q.files.push(new l(i.uid,r))})},999),this.getRuntime().shimExec.call(this,"FileInput","init",{accept:p.accept,multiple:p.multiple}),this.trigger("ready")}};return m.FileInput=o}),k("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(m,l){function a(p,n){switch(n){case"readAsText":return l.atob(p,"utf8");case"readAsBinaryString":return l.atob(p);case"readAsDataURL":return p}return null}var o={read:function(p,i){var q=this;return q.result="","readAsDataURL"===p&&(q.result="data:"+(i.type||"")+";base64,"),q.bind("Progress",function(e,n){n&&(q.result+=a(n,p))},999),q.getRuntime().shimExec.call(this,"FileReader","readAsBase64",i.uid)}};return m.FileReader=o}),k("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(m,l){function a(p,n){switch(n){case"readAsText":return l.atob(p,"utf8");case"readAsBinaryString":return l.atob(p);case"readAsDataURL":return p}return null}var o={read:function(q,i){var s,p=this.getRuntime();return(s=p.shimExec.call(this,"FileReaderSync","readAsBase64",i.uid))?("readAsDataURL"===q&&(s="data:"+(i.type||"")+";base64,"+s),a(s,q,i.type)):null}};return m.FileReaderSync=o}),k("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(m,l){var a={getAsBlob:function(p){var o=this.getRuntime(),q=o.shimExec.call(this,"Transporter","getAsBlob",p);return q?new l(o.uid,q):null}};return m.Transporter=a}),k("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/runtime/flash/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter","moxie/runtime/flash/runtime/Transporter"],function(v,y,q,p,l,m,w,z){var x={send:function(B,s){function a(){B.transport=A.mode,A.shimExec.call(D,"XMLHttpRequest","send",B,s)}function i(o,n){A.shimExec.call(D,"XMLHttpRequest","appendBlob",o,n.uid),s=null,a()}function E(r,o){var n=new z;n.bind("TransportingComplete",function(){o(this.result)}),n.transport(r.getSource(),r.type,{ruid:A.uid})}var D=this,A=D.getRuntime();if(y.isEmptyObj(B.headers)||y.each(B.headers,function(o,n){A.shimExec.call(D,"XMLHttpRequest","setRequestHeader",n,o.toString())}),s instanceof w){var C;if(s.each(function(o,n){o instanceof q?C=n:A.shimExec.call(D,"XMLHttpRequest","append",n,o)}),s.hasBlob()){var t=s.getBlob();t.isDetached()?E(t,function(n){t.destroy(),i(C,n)}):i(C,t)}else{s=null,a()}}else{s instanceof q?s.isDetached()?E(s,function(n){s.destroy(),s=n.uid,a()}):(s=s.uid,a()):a()}},getResponse:function(s){var r,t,n=this.getRuntime();if(t=n.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(t=new p(n.uid,t),"blob"===s){return t}try{if(r=new l,~y.inArray(s,["","text"])){return r.readAsText(t)}if("json"===s&&window.JSON){return JSON.parse(r.readAsText(t))}}finally{t.destroy()}}return null},abort:function(){var a=this.getRuntime();a.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return v.XMLHttpRequest=x}),k("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(p,l,a,s,m){var q={loadFromBlob:function(v){function i(n){u.shimExec.call(x,"Image","loadFromBlob",n.uid),x=u=null}var x=this,u=x.getRuntime();if(v.isDetached()){var w=new a;w.bind("TransportingComplete",function(){i(w.result.getSource())}),w.transport(v.getSource(),v.type,{ruid:u.uid})}else{i(v.getSource())}},loadFromImage:function(n){var i=this.getRuntime();return i.shimExec.call(this,"Image","loadFromImage",n.uid)},getInfo:function(){var n=this.getRuntime(),i=n.shimExec.call(this,"Image","getInfo");return i.meta&&i.meta.thumb&&i.meta.thumb.data&&!(n.meta.thumb.data instanceof s)&&(i.meta.thumb.data=new s(n.uid,i.meta.thumb.data)),i},getAsBlob:function(v,o){var n=this.getRuntime(),u=n.shimExec.call(this,"Image","getAsBlob",v,o);return u?new s(n.uid,u):null},getAsDataURL:function(){var r,o=this.getRuntime(),n=o.Image.getAsBlob.apply(this,arguments);return n?(r=new m,r.readAsDataURL(n)):null}};return p.Image=q}),k("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(q,x,p,m,l){function v(E){var J,D,B,z,A,H=!1,K=null,I=0;try{try{K=new ActiveXObject("AgControl.AgControl"),K.IsVersionSupported(E)&&(H=!0),K=null}catch(G){var C=navigator.plugins["Silverlight Plug-In"];if(C){for(J=C.description,"1.0.30226.2"===J&&(J="2.0.30226.2"),D=J.split(".");D.length>3;){D.pop()}for(;D.length<4;){D.push(0)}for(B=E.split(".");B.length>4;){B.pop()}do{z=parseInt(B[I],10),A=parseInt(D[I],10),I++}while(I<B.length&&z===A);A>=z&&!isNaN(z)&&(H=!0)}}}catch(F){H=!1}return H}function y(e){var a,i=this;e=q.extend({xap_url:x.xap_url},e),l.call(this,e,w,{access_binary:l.capTrue,access_image_binary:l.capTrue,display_media:l.capTest(g("moxie/image/Image")),do_cors:l.capTrue,drag_and_drop:!1,report_upload_progress:l.capTrue,resize_image:l.capTrue,return_response_headers:function(n){return n&&"client"===i.mode},return_response_type:function(n){return"json"!==n?!0:!!window.JSON},return_status_code:function(n){return"client"===i.mode||!q.arrayDiff(n,[200,404])},select_file:l.capTrue,select_multiple:l.capTrue,send_binary_string:l.capTrue,send_browser_cookies:function(n){return n&&"browser"===i.mode},send_custom_headers:function(n){return n&&"client"===i.mode},send_multipart:l.capTrue,slice_blob:l.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:l.capTrue,use_http_method:function(n){return"client"===i.mode||!q.arrayDiff(n,["GET","POST"])}},{return_response_headers:function(n){return n?"client":"browser"},return_status_code:function(n){return q.arrayDiff(n,[200,404])?"client":["client","browser"]},send_browser_cookies:function(n){return n?"browser":"client"},send_custom_headers:function(n){return n?"client":"browser"},use_http_method:function(n){return q.arrayDiff(n,["GET","POST"])?"client":["client","browser"]}}),v("2.0.31005.0")&&"Opera"!==x.browser||(this.mode=!1),q.extend(this,{getShim:function(){return p.get(this.uid).content.Moxie},shimExec:function(s,o){var n=[].slice.call(arguments,2);return i.getShim().exec(this.uid,s,o,n)},init:function(){var n;n=this.getShimContainer(),n.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+e.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+x.global_event_dispatcher+'"/></object>',a=setTimeout(function(){i&&!i.initialized&&i.trigger("Error",new m.RuntimeError(m.RuntimeError.NOT_INIT_ERR))},"Windows"!==x.OS?10000:5000)},destroy:function(n){return function(){n.call(i),clearTimeout(a),e=a=n=i=null}}(this.destroy)},r)}var w="silverlight",r={};return l.addConstructor(w,y),r}),k("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(m,l,a){return m.Blob=l.extend({},a)}),k("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime","moxie/file/File","moxie/core/utils/Basic"],function(o,l,a){function p(r){for(var q="",n=0;n<r.length;n++){q+=(""!==q?"|":"")+r[n].title+" | *."+r[n].extensions.replace(/,/g,";*.")}return q}var m={init:function(n){var i=this,q=this.getRuntime();this.bind("Change",function(){var r=q.shimExec.call(i,"FileInput","getFiles");i.files=[],a.each(r,function(s){i.files.push(new l(q.uid,s))})},999),q.shimExec.call(this,"FileInput","init",p(n.accept),n.multiple),this.trigger("ready")},setOption:function(n,i){"accept"==n&&(i=p(i)),this.getRuntime().shimExec.call(this,"FileInput","setOption",n,i)}};return o.FileInput=m}),k("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(m,l,a){var o={init:function(){var p,q=this,i=q.getRuntime();return p=i.getShimContainer(),a.addEvent(p,"dragover",function(n){n.preventDefault(),n.stopPropagation(),n.dataTransfer.dropEffect="copy"},q.uid),a.addEvent(p,"dragenter",function(r){r.preventDefault();var n=l.get(i.uid).dragEnter(r);n&&r.stopPropagation()},q.uid),a.addEvent(p,"drop",function(r){r.preventDefault();var n=l.get(i.uid).dragDrop(r);n&&r.stopPropagation()},q.uid),i.shimExec.call(this,"FileDrop","init")}};return m.FileDrop=o}),k("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(m,l,a){return m.FileReader=l.extend({},a)}),k("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(m,l,a){return m.FileReaderSync=l.extend({},a)}),k("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(m,l,a){return m.Transporter=l.extend({},a)}),k("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/silverlight/file/FileReaderSync","moxie/runtime/silverlight/runtime/Transporter"],function(m,l,a){return m.XMLHttpRequest=l.extend({},a)}),k("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(m,l,a,o){return m.Image=l.extend({},o,{getInfo:function(){var p=this.getRuntime(),s=["tiff","exif","gps","thumb"],i={meta:{}},q=p.shimExec.call(this,"Image","getInfo");return q.meta&&(l.each(s,function(x){var v,u,y,r,w=q.meta[x];if(w&&w.keys){for(i.meta[x]={},u=0,y=w.keys.length;y>u;u++){v=w.keys[u],r=w[v],r&&(/^(\d|[1-9]\d+)$/.test(r)?r=parseInt(r,10):/^\d*\.\d+$/.test(r)&&(r=parseFloat(r)),i.meta[x][v]=r)}}}),i.meta&&i.meta.thumb&&i.meta.thumb.data&&!(p.meta.thumb.data instanceof a)&&(i.meta.thumb.data=new a(p.uid,i.meta.thumb.data))),i.width=parseInt(q.width,10),i.height=parseInt(q.height,10),i.size=parseInt(q.size,10),i.type=q.type,i.name=q.name,i},resize:function(q,p,n){this.getRuntime().shimExec.call(this,"Image","resize",q.x,q.y,q.width,q.height,p,n.preserveHeaders,n.resample)}})}),k("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(r,p,m,v){function u(e){var i=this,a=m.capTest,n=m.capTrue;m.call(this,e,l,{access_binary:a(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:a((v.can("create_canvas")||v.can("use_data_uri_over32kb"))&&g("moxie/image/Image")),do_cors:!1,drag_and_drop:!1,filter_by_extension:a(function(){return !("Chrome"===v.browser&&v.verComp(v.version,28,"<")||"IE"===v.browser&&v.verComp(v.version,10,"<")||"Safari"===v.browser&&v.verComp(v.version,7,"<")||"Firefox"===v.browser&&v.verComp(v.version,37,"<"))}()),resize_image:function(){return q.Image&&i.can("access_binary")&&v.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(o){return"json"===o&&window.JSON?!0:!!~r.inArray(o,["text","document",""])},return_status_code:function(o){return !r.arrayDiff(o,[200,404])},select_file:function(){return v.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return i.can("select_file")},summon_file_dialog:function(){return i.can("select_file")&&("Firefox"===v.browser&&v.verComp(v.version,4,">=")||"Opera"===v.browser&&v.verComp(v.version,12,">=")||"IE"===v.browser&&v.verComp(v.version,10,">=")||!!~r.inArray(v.browser,["Chrome","Safari"]))},upload_filesize:n,use_http_method:function(o){return !r.arrayDiff(o,["GET","POST"])}}),r.extend(this,{init:function(){this.trigger("Init")},destroy:function(o){return function(){o.call(i),o=i=null}}(this.destroy)}),r.extend(this.getShim(),q)}var l="html4",q={};return m.addConstructor(l,u),q}),k("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/file/File","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(v,p,m,x,u,w,l){function q(){function o(){var B,C,A,e,s,y,z=this,t=z.getRuntime();y=m.guid("uid_"),B=t.getShimContainer(),n&&(A=x.get(n+"_form"),A&&m.extend(A.style,{top:"100%"})),e=document.createElement("form"),e.setAttribute("id",y+"_form"),e.setAttribute("method","post"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),m.extend(e.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),s=document.createElement("input"),s.setAttribute("id",y),s.setAttribute("type","file"),s.setAttribute("accept",a.join(",")),m.extend(s.style,{fontSize:"999px",opacity:0}),e.appendChild(s),B.appendChild(e),m.extend(s.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===l.browser&&l.verComp(l.version,10,"<")&&m.extend(s.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),s.onchange=function(){var D;if(this.value){if(this.files){if(D=this.files[0],0===D.size){return e.parentNode.removeChild(e),void 0}}else{D={name:this.value}}D=new p(t.uid,D),this.onchange=function(){},o.call(z),z.files=[D],s.setAttribute("id",D.uid),e.setAttribute("id",D.uid+"_form"),z.trigger("change"),s=e=null}},t.can("summon_file_dialog")&&(C=x.get(i.browse_button),u.removeEvent(C,"click",z.uid),u.addEvent(C,"click",function(D){s&&!s.disabled&&s.click(),D.preventDefault()},z.uid)),n=y,B=A=C=null}var n,i,r,a=[];m.extend(this,{init:function(z){var y,e=this,A=e.getRuntime();i=z,a=z.accept.mimes||w.extList2mimes(z.accept,A.can("filter_by_extension")),y=A.getShimContainer(),function(){var t,B,s;t=x.get(z.browse_button),r=x.getStyle(t,"z-index")||"auto",A.can("summon_file_dialog")&&("static"===x.getStyle(t,"position")&&(t.style.position="relative"),e.bind("Refresh",function(){B=parseInt(r,10)||1,x.get(i.browse_button).style.zIndex=B,this.getRuntime().getShimContainer().style.zIndex=B-1})),s=A.can("summon_file_dialog")?t:y,u.addEvent(s,"mouseover",function(){e.trigger("mouseenter")},e.uid),u.addEvent(s,"mouseout",function(){e.trigger("mouseleave")},e.uid),u.addEvent(s,"mousedown",function(){e.trigger("mousedown")},e.uid),u.addEvent(x.get(z.container),"mouseup",function(){e.trigger("mouseup")},e.uid),t=null}(),o.call(this),y=null,e.trigger({type:"ready",async:!0})},setOption:function(A,y){var s,z=this.getRuntime();"accept"==A&&(a=y.mimes||w.extList2mimes(y,z.can("filter_by_extension"))),s=x.get(n),s&&s.setAttribute("accept",a.join(","))},disable:function(y){var s;(s=x.get(n))&&(s.disabled=!!y)},destroy:function(){var A=this.getRuntime(),z=A.getShim(),y=A.getShimContainer(),B=i&&x.get(i.container),s=i&&x.get(i.browse_button);B&&u.removeAllEvents(B,this.uid),s&&(u.removeAllEvents(s,this.uid),s.style.zIndex=r),y&&(u.removeAllEvents(y,this.uid),y.innerHTML=""),z.removeInstance(this.uid),n=a=i=y=B=s=z=null}})}return v.FileInput=q}),k("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(i,a){return i.FileReader=a}),k("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(v,y,q,p,l,m,w,z){function x(){function n(F){var C,G,E,A,D=this,B=!1;if(a){if(C=a.id.replace(/_iframe$/,""),G=q.get(C+"_form")){for(E=G.getElementsByTagName("input"),A=E.length;A--;){switch(E[A].getAttribute("type")){case"hidden":E[A].parentNode.removeChild(E[A]);break;case"file":B=!0}}E=[],B||G.parentNode.removeChild(G),G=null}setTimeout(function(){m.removeEvent(a,"load",D.uid),a.parentNode&&a.parentNode.removeChild(a);var e=D.getRuntime().getShimContainer();e.children.length||e.parentNode.removeChild(e),e=a=null,F()},1)}}var i,o,a;y.extend(this,{send:function(A,r){function s(){var E=C.getShimContainer()||document.body,F=document.createElement("div");F.innerHTML='<iframe id="'+u+'_iframe" name="'+u+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',a=F.firstChild,E.appendChild(a),m.addEvent(a,"load",function(){var G;try{G=a.contentWindow.document||a.contentDocument||window.frames[a.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(G.title)?i=G.title.replace(/^(\d+).*$/,"$1"):(i=200,o=y.trim(G.body.innerHTML),D.trigger({type:"progress",loaded:o.length,total:o.length}),B&&D.trigger({type:"uploadprogress",loaded:B.size||1025,total:B.size||1025}))}catch(H){if(!p.hasSameOrigin(A.url)){return n.call(D,function(){D.trigger("error")}),void 0}i=404}n.call(D,function(){D.trigger("load")})},D.uid)}var u,e,t,B,D=this,C=D.getRuntime();if(i=o=null,r instanceof z&&r.hasBlob()){if(B=r.getBlob(),u=B.uid,t=q.get(u),e=q.get(u+"_form"),!e){throw new l.DOMException(l.DOMException.NOT_FOUND_ERR)}}else{u=y.guid("uid_"),e=document.createElement("form"),e.setAttribute("id",u+"_form"),e.setAttribute("method",A.method),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),C.getShimContainer().appendChild(e)}e.setAttribute("target",u+"_iframe"),r instanceof z&&r.each(function(F,E){if(F instanceof w){t&&t.setAttribute("name",E)}else{var G=document.createElement("input");y.extend(G,{type:"hidden",name:E,value:F}),t?e.insertBefore(G,t):e.appendChild(G)}}),e.setAttribute("action",A.url),s(),e.submit(),D.trigger("loadstart")},getStatus:function(){return i},getResponse:function(s){if("json"===s&&"string"===y.typeOf(o)&&window.JSON){try{return JSON.parse(o.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(r){return null}}return o},abort:function(){var e=this;a&&a.contentWindow&&(a.contentWindow.stop?a.contentWindow.stop():a.contentWindow.document.execCommand?a.contentWindow.document.execCommand("Stop"):a.src="about:blank"),n.call(this,function(){e.dispatchEvent("abort")})}})}return v.XMLHttpRequest=x}),k("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(i,a){return i.Image=a}),b(["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Dom","moxie/core/EventTarget","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/core/I18n","moxie/core/utils/Mime","moxie/file/FileInput","moxie/file/File","moxie/file/FileDrop","moxie/file/FileReader","moxie/core/utils/Url","moxie/runtime/RuntimeTarget","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events","moxie/runtime/html5/image/ResizerCanvas"])}(this)});!function(c,b){var a=function(){var d={};return b.apply(d,arguments),d.plupload};"function"==typeof define&&define.amd?define("plupload",["./moxie"],a):"object"==typeof module&&module.exports?module.exports=a(require("./moxie")):c.plupload=a(c.moxie)}(this||window,function(a){!function(h,k,g){function d(p){function o(v,s,n){var u={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};u[v]?q[u[v]]=s:n||(q[v]=s)}var l=p.required_features,q={};return"string"==typeof l?f.each(l.split(/\s*,\s*/),function(i){o(i,!0)}):"object"==typeof l?f.each(l,function(r,n){o(n,r)}):l===!0&&(p.chunk_size&&p.chunk_size>0&&(q.slice_blob=!0),f.isEmptyObj(p.resize)&&p.multipart!==!1||(q.send_binary_string=!0),p.http_method&&(q.use_http_method=p.http_method),f.each(p,function(r,n){o(n,!!r,!0)})),q}var b=window.setTimeout,m={},j=k.core.utils,c=k.runtime.Runtime,f={VERSION:"2.3.1",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:j.Mime.mimes,ua:j.Env,typeOf:j.Basic.typeOf,extend:j.Basic.extend,guid:j.Basic.guid,getAll:function(p){var o,l=[];"array"!==f.typeOf(p)&&(p=[p]);for(var q=p.length;q--;){o=f.get(p[q]),o&&l.push(o)}return l.length?l:null},get:j.Dom.get,each:j.Basic.each,getPos:j.Dom.getPos,getSize:j.Dom.getSize,xmlEncode:function(o){var n={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},l=/[<>&\"\']/g;return o?(""+o).replace(l,function(i){return n[i]?"&"+n[i]+";":i}):o},toArray:j.Basic.toArray,inArray:j.Basic.inArray,inSeries:j.Basic.inSeries,addI18n:k.core.I18n.addI18n,translate:k.core.I18n.translate,sprintf:j.Basic.sprintf,isEmptyObj:j.Basic.isEmptyObj,hasClass:j.Dom.hasClass,addClass:j.Dom.addClass,removeClass:j.Dom.removeClass,getStyle:j.Dom.getStyle,addEvent:j.Events.addEvent,removeEvent:j.Events.removeEvent,removeAllEvents:j.Events.removeAllEvents,cleanName:function(o){var n,l;for(l=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],n=0;n<l.length;n+=2){o=o.replace(l[n],l[n+1])}return o=o.replace(/\s+/g,"_"),o=o.replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(o,n){var l="";return f.each(n,function(p,i){l+=(l?"&":"")+encodeURIComponent(i)+"="+encodeURIComponent(p)}),l&&(o+=(o.indexOf("?")>0?"&":"?")+l),o},formatSize:function(l){function i(p,n){return Math.round(p*Math.pow(10,n))/Math.pow(10,n)}if(l===g||/\D/.test(l)){return f.translate("N/A")}var o=Math.pow(1024,4);return l>o?i(l/o,1)+" "+f.translate("tb"):l>(o/=1024)?i(l/o,1)+" "+f.translate("gb"):l>(o/=1024)?i(l/o,1)+" "+f.translate("mb"):l>1024?Math.round(l/1024)+" "+f.translate("kb"):l+" "+f.translate("b")},parseSize:j.Basic.parseSizeStr,predictRuntime:function(p,o){var l,q;return l=new f.Uploader(p),q=c.thatCan(l.getOption().required_features,o||p.runtimes),l.destroy(),q},addFileFilter:function(l,i){m[l]=i}};f.addFileFilter("mime_types",function(o,n,l){o.length&&!o.regexp.test(n.name)?(this.trigger("Error",{code:f.FILE_EXTENSION_ERROR,message:f.translate("File extension error."),file:n}),l(!1)):l(!0)}),f.addFileFilter("max_file_size",function(p,o,l){var q;p=f.parseSize(p),o.size!==q&&p&&o.size>p?(this.trigger("Error",{code:f.FILE_SIZE_ERROR,message:f.translate("File size error."),file:o}),l(!1)):l(!0)}),f.addFileFilter("prevent_duplicates",function(p,o,l){if(p){for(var q=this.files.length;q--;){if(o.name===this.files[q].name&&o.size===this.files[q].size){return this.trigger("Error",{code:f.FILE_DUPLICATE_ERROR,message:f.translate("Duplicate file error."),file:o}),l(!1),void 0}}}l(!0)}),f.Uploader=function(Z){function ad(){var v,u,p=0;if(this.state==f.STARTED){for(u=0;u<B.length;u++){v||B[u].status!=f.QUEUED?p++:(v=B[u],this.trigger("BeforeUpload",v)&&(v.status=f.UPLOADING,this.trigger("UploadFile",v)))}p==B.length&&(this.state!==f.STOPPED&&(this.state=f.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",B))}}function K(p){p.percent=p.size>0?Math.ceil(100*(p.loaded/p.size)):100,aa()}function aa(){var v,p,w,u=0;for(G.reset(),v=0;v<B.length;v++){p=B[v],p.size!==g?(G.size+=p.origSize,w=p.loaded*p.origSize/p.size,(!p.completeTimestamp||p.completeTimestamp>C)&&(u+=w),G.loaded+=w):G.size=g,p.status==f.DONE?G.uploaded++:p.status==f.FAILED?G.failed++:G.queued++}G.size===g?G.percent=B.length>0?Math.ceil(100*(G.uploaded/B.length)):0:(G.bytesPerSec=Math.ceil(u/((+new Date-C||1)/1000)),G.percent=G.size>0?Math.ceil(100*(G.loaded/G.size)):0)}function ab(){var p=i[0]||J[0];return p?p.getRuntime().uid:!1}function Y(v,u){if(v.ruid){var p=c.getInfo(v.ruid);if(p){return p.can(u)}}return !1}function Q(){this.bind("FilesAdded FilesRemoved",function(p){p.trigger("QueueChanged"),p.refresh()}),this.bind("CancelUpload",t),this.bind("BeforeUpload",ae),this.bind("UploadFile",L),this.bind("UploadProgress",H),this.bind("StateChanged",ac),this.bind("QueueChanged",aa),this.bind("Error",s),this.bind("FileUploaded",o),this.bind("Destroy",r)}function X(x,u){var y=this,w=0,v=[],p={runtime_order:x.runtimes,required_caps:x.required_features,preferred_caps:q,swf_url:x.flash_swf_url,xap_url:x.silverlight_xap_url};f.each(x.runtimes.split(/\s*,\s*/),function(e){x[e]&&(p[e]=x[e])}),x.browse_button&&f.each(x.browse_button,function(e){v.push(function(A){var z=new k.file.FileInput(f.extend({},p,{accept:x.filters.mime_types,name:x.file_data_name,multiple:x.multi_selection,container:x.container,browse_button:e}));z.onready=function(){var D=c.getInfo(this.ruid);f.extend(y.features,{chunks:D.can("slice_blob"),multipart:D.can("send_multipart"),multi_selection:D.can("select_multiple")}),w++,i.push(this),A()},z.onchange=function(){y.addFile(this.files)},z.bind("mouseenter mouseleave mousedown mouseup",function(D){N||(x.browse_button_hover&&("mouseenter"===D.type?f.addClass(e,x.browse_button_hover):"mouseleave"===D.type&&f.removeClass(e,x.browse_button_hover)),x.browse_button_active&&("mousedown"===D.type?f.addClass(e,x.browse_button_active):"mouseup"===D.type&&f.removeClass(e,x.browse_button_active)))}),z.bind("mousedown",function(){y.trigger("Browse")}),z.bind("error runtimeerror",function(){z=null,A()}),z.init()})}),x.drop_element&&f.each(x.drop_element,function(z){v.push(function(e){var A=new k.file.FileDrop(f.extend({},p,{drop_zone:z}));A.onready=function(){var D=c.getInfo(this.ruid);f.extend(y.features,{chunks:D.can("slice_blob"),multipart:D.can("send_multipart"),dragdrop:D.can("drag_and_drop")}),w++,J.push(this),e()},A.ondrop=function(){y.addFile(this.files)},A.bind("error runtimeerror",function(){A=null,e()}),A.init()})}),f.inSeries(v,function(){"function"==typeof u&&u(w)})}function W(w,x,v){var u=new k.image.Image;try{u.onload=function(){return x.width>this.width&&x.height>this.height&&x.quality===g&&x.preserve_headers&&!x.crop?(this.destroy(),v(w)):(u.downsize(x.width,x.height,x.crop,x.preserve_headers),void 0)},u.onresize=function(){v(this.getAsBlob(w.type,x.quality)),this.destroy()},u.onerror=function(){v(w)},u.load(w)}catch(p){v(w)}}function V(z,w,y){function x(D,u,E){var A=n[D];switch(D){case"max_file_size":"max_file_size"===D&&(n.max_file_size=n.filters.max_file_size=u);break;case"chunk_size":(u=f.parseSize(u))&&(n[D]=u,n.send_file_name=!0);break;case"multipart":n[D]=u,u||(n.send_file_name=!0);break;case"http_method":n[D]="PUT"===u.toUpperCase()?"PUT":"POST";break;case"unique_names":n[D]=u,u&&(n.send_file_name=!0);break;case"filters":"array"===f.typeOf(u)&&(u={mime_types:u}),E?f.extend(n.filters,u):n.filters=u,u.mime_types&&("string"===f.typeOf(u.mime_types)&&(u.mime_types=k.core.utils.Mime.mimes2extList(u.mime_types)),u.mime_types.regexp=function(I){var F=[];return f.each(I,function(O){f.each(O.extensions.split(/,/),function(P){/^\s*\*\s*$/.test(P)?F.push("\\.*"):F.push("\\."+P.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+F.join("|")+")$","i")}(u.mime_types),n.filters.mime_types=u.mime_types);break;case"resize":n.resize=u?f.extend({preserve_headers:!0,crop:!1},u):!1;break;case"prevent_duplicates":n.prevent_duplicates=n.filters.prevent_duplicates=!!u;break;case"container":case"browse_button":case"drop_element":u="container"===D?f.get(u):f.getAll(u);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":n[D]=u,E||(v=!0);break;default:n[D]=u}E||p.trigger("OptionChanged",D,u,A)}var p=this,v=!1;"object"==typeof z?f.each(z,function(A,u){x(u,A,y)}):x(z,w,y),y?(n.required_features=d(f.extend({},n)),q=d(f.extend({},n,{required_features:!0}))):v&&(p.trigger("Destroy"),X.call(p,n,function(u){u?(p.runtime=c.getInfo(ab()).type,p.trigger("Init",{runtime:p.runtime}),p.trigger("PostInit")):p.trigger("Error",{code:f.INIT_ERROR,message:f.translate("Init error.")})}))}function ae(v,u){if(v.settings.unique_names){var p=u.name.match(/\.([^.]+)$/),w="part";p&&(w=p[1]),u.target_name=u.id+"."+w}}function L(A,y){function x(){E-->0?b(O,1000):(y.loaded=z,A.trigger("Error",{code:f.HTTP_ERROR,message:f.translate("HTTP Error."),file:y,response:l.responseText,status:l.status,responseHeaders:l.getAllResponseHeaders()}))}function O(){var e,u,p={};y.status===f.UPLOADING&&A.state!==f.STOPPED&&(A.settings.send_file_name&&(p.name=y.target_name||y.name),D&&v.chunks&&w.size>D?(u=Math.min(D,w.size-z),e=w.slice(z,z+u)):(u=w.size,e=w),D&&v.chunks&&(A.settings.send_chunk_number?(p.chunk=Math.ceil(z/D),p.chunks=Math.ceil(w.size/D)):(p.offset=z,p.total=w.size)),A.trigger("BeforeChunkUpload",y,p,e,z)&&F(p,e,u))}function F(e,P,u){var p;l=new k.xhr.XMLHttpRequest,l.upload&&(l.upload.onprogress=function(R){y.loaded=Math.min(y.size,z+R.loaded),A.trigger("UploadProgress",y)}),l.onload=function(){return l.status>=400?(x(),void 0):(E=A.settings.max_retries,u<w.size?(P.destroy(),z+=u,y.loaded=Math.min(z,w.size),A.trigger("ChunkUploaded",y,{offset:y.loaded,total:w.size,response:l.responseText,status:l.status,responseHeaders:l.getAllResponseHeaders()}),"Android Browser"===f.ua.browser&&A.trigger("UploadProgress",y)):y.loaded=y.size,P=p=null,!z||z>=w.size?(y.size!=y.origSize&&(w.destroy(),w=null),A.trigger("UploadProgress",y),y.status=f.DONE,y.completeTimestamp=+new Date,A.trigger("FileUploaded",y,{response:l.responseText,status:l.status,responseHeaders:l.getAllResponseHeaders()})):b(O,1),void 0)},l.onerror=function(){x()},l.onloadend=function(){this.destroy(),l=null},A.settings.multipart&&v.multipart?(l.open(A.settings.http_method,I,!0),f.each(A.settings.headers,function(S,R){l.setRequestHeader(R,S)}),p=new k.xhr.FormData,f.each(f.extend(e,A.settings.multipart_params),function(S,R){p.append(R,S)}),p.append(A.settings.file_data_name,P),l.send(p,{runtime_order:A.settings.runtimes,required_caps:A.settings.required_features,preferred_caps:q,swf_url:A.settings.flash_swf_url,xap_url:A.settings.silverlight_xap_url})):(I=f.buildUrl(A.settings.url,f.extend(e,A.settings.multipart_params)),l.open(A.settings.http_method,I,!0),f.each(A.settings.headers,function(S,R){l.setRequestHeader(R,S)}),l.hasRequestHeader("Content-Type")||l.setRequestHeader("Content-Type","application/octet-stream"),l.send(P,{runtime_order:A.settings.runtimes,required_caps:A.settings.required_features,preferred_caps:q,swf_url:A.settings.flash_swf_url,xap_url:A.settings.silverlight_xap_url}))}var w,I=A.settings.url,D=A.settings.chunk_size,E=A.settings.max_retries,v=A.features,z=0;y.loaded&&(z=y.loaded=D?D*Math.floor(y.loaded/D):0),w=y.getSource(),!f.isEmptyObj(A.settings.resize)&&Y(w,"send_binary_string")&&-1!==f.inArray(w.type,["image/jpeg","image/png"])?W.call(this,w,A.settings.resize,function(p){w=p,y.size=p.size,O()}):O()}function H(u,p){K(p)}function ac(u){if(u.state==f.STARTED){C=+new Date}else{if(u.state==f.STOPPED){for(var p=u.files.length-1;p>=0;p--){u.files[p].status==f.UPLOADING&&(u.files[p].status=f.QUEUED,aa())}}}}function t(){l&&l.abort()}function o(p){aa(),b(function(){ad.call(p)},1)}function s(u,p){p.code===f.INIT_ERROR?u.destroy():p.code===f.HTTP_ERROR&&(p.file.status=f.FAILED,p.file.completeTimestamp=+new Date,K(p.file),u.state==f.STARTED&&(u.trigger("CancelUpload"),b(function(){ad.call(u)},1)))}function r(p){p.stop(),f.each(B,function(u){u.destroy()}),B=[],i.length&&(f.each(i,function(u){u.destroy()}),i=[]),J.length&&(f.each(J,function(u){u.destroy()}),J=[]),q={},N=!1,C=l=null,G.reset()}var n,C,G,l,M=f.guid(),B=[],q={},i=[],J=[],N=!1;n={chunk_size:0,file_data_name:"file",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_retries:0,multipart:!0,multi_selection:!0,resize:!1,runtimes:c.order,send_file_name:!0,send_chunk_number:!0,silverlight_xap_url:"js/Moxie.xap"},V.call(this,Z,null,!0),G=new f.QueueProgress,f.extend(this,{id:M,uid:M,state:f.STOPPED,features:{},runtime:null,files:B,settings:n,total:G,init:function(){var v,u,p=this;return v=p.getOption("preinit"),"function"==typeof v?v(p):f.each(v,function(x,w){p.bind(w,x)}),Q.call(p),f.each(["container","browse_button","drop_element"],function(w){return null===p.getOption(w)?(u={code:f.INIT_ERROR,message:f.sprintf(f.translate("%s specified, but cannot be found."),w)},!1):void 0}),u?p.trigger("Error",u):n.browse_button||n.drop_element?(X.call(p,n,function(x){var w=p.getOption("init");"function"==typeof w?w(p):f.each(w,function(z,y){p.bind(y,z)}),x?(p.runtime=c.getInfo(ab()).type,p.trigger("Init",{runtime:p.runtime}),p.trigger("PostInit")):p.trigger("Error",{code:f.INIT_ERROR,message:f.translate("Init error.")})}),void 0):p.trigger("Error",{code:f.INIT_ERROR,message:f.translate("You must specify either browse_button or drop_element.")})},setOption:function(u,p){V.call(this,u,p,!this.runtime)},getOption:function(p){return p?n[p]:n},refresh:function(){i.length&&f.each(i,function(p){p.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=f.STARTED&&(this.state=f.STARTED,this.trigger("StateChanged"),ad.call(this))},stop:function(){this.state!=f.STOPPED&&(this.state=f.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){N=arguments[0]!==g?arguments[0]:!0,i.length&&f.each(i,function(p){p.disable(N)}),this.trigger("DisableBrowse",N)},getFile:function(u){var p;for(p=B.length-1;p>=0;p--){if(B[p].id===u){return B[p]}}},addFile:function(y,w){function D(F,E){var u=[];f.each(v.settings.filters,function(e,I){m[I]&&u.push(function(O){m[I].call(v,e,F,function(P){O(!P)})})}),f.inSeries(u,E)}function p(E){var u=f.typeOf(E);if(E instanceof k.file.File){if(!E.ruid&&!E.isDetached()){if(!A){return !1}E.ruid=A,E.connectRuntime(A)}p(new f.File(E))}else{E instanceof k.file.Blob?(p(E.getSource()),E.destroy()):E instanceof f.File?(w&&(E.name=w),z.push(function(e){D(E,function(F){F||(B.push(E),x.push(E),v.trigger("FileFiltered",E)),b(e,1)})})):-1!==f.inArray(u,["file","blob"])?p(new k.file.File(null,E)):"node"===u&&"filelist"===f.typeOf(E.files)?f.each(E.files,p):"array"===u&&(w=null,f.each(E,p))}}var A,v=this,z=[],x=[];A=ab(),p(y),z.length&&f.inSeries(z,function(){x.length&&v.trigger("FilesAdded",x)})},removeFile:function(v){for(var u="string"==typeof v?v:v.id,p=B.length-1;p>=0;p--){if(B[p].id===u){return this.splice(p,1)[0]}}},splice:function(v,p){var w=B.splice(v===g?0:v,p===g?B.length:p),u=!1;return this.state==f.STARTED&&(f.each(w,function(x){return x.status===f.UPLOADING?(u=!0,!1):void 0}),u&&this.stop()),this.trigger("FilesRemoved",w),f.each(w,function(x){x.destroy()}),u&&this.start(),w},dispatchEvent:function(v){var u,p;if(v=v.toLowerCase(),u=this.hasEventListener(v)){u.sort(function(y,x){return x.priority-y.priority}),p=[].slice.call(arguments),p.shift(),p.unshift(this);for(var w=0;w<u.length;w++){if(u[w].fn.apply(u[w].scope,p)===!1){return !1}}}return !0},bind:function(v,u,p,w){f.Uploader.prototype.bind.call(this,v,u,w,p)},destroy:function(){this.trigger("Destroy"),n=G=null,this.unbindAll()}})},f.Uploader.prototype=k.core.EventTarget.instance,f.File=function(){function l(n){f.extend(this,{id:f.guid(),name:n.name||n.fileName,type:n.type||"",size:n.size||n.fileSize,origSize:n.size||n.fileSize,loaded:0,percent:0,status:f.QUEUED,lastModifiedDate:n.lastModifiedDate||(new Date).toLocaleString(),completeTimestamp:0,getNative:function(){var o=this.getSource().getSource();return -1!==f.inArray(f.typeOf(o),["blob","file"])?o:null},getSource:function(){return i[this.id]?i[this.id]:null},destroy:function(){var o=this.getSource();o&&(o.destroy(),delete i[this.id])}}),i[this.id]=n}var i={};return l}(),f.QueueProgress=function(){var i=this;i.size=0,i.loaded=0,i.uploaded=0,i.failed=0,i.queued=0,i.percent=0,i.bytesPerSec=0,i.reset=function(){i.size=i.loaded=i.uploaded=i.failed=i.queued=i.percent=i.bytesPerSec=0}},h.plupload=f}(this,a)});